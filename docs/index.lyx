#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass extarticle
\use_default_options true
\begin_modules
eqs-within-sections
figs-within-sections
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type authoryear
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 4cm
\topmargin 2cm
\rightmargin 3cm
\bottommargin 4cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
The Haujobb Amiga Framework
\end_layout

\begin_layout Abstract
If you want to code Amiga AGA demos, are able to program, but don't know
 how to get started on the Amiga, then this document is for you.
 Also if you are already more experienced on Amiga and want to learn about
 how we do our demos.
 This document describes how to set up and use the Haujobb Amiga Framework
 on Amiga and PC.
 The framework allows for prototyping, debugging, and timing effects natively
 on the PC (currently Windows mainly, but Mac and Linux should work as well);
 and then cross-compiling for the Amiga.
 We have used these exact codes and workflows for our demo 
\emph on
Beam Riders
\emph default
; and prior versions for 
\emph on
Last Train to Danzig
\emph default
 and 
\emph on
Prototype 1
\emph default
.
\end_layout

\begin_layout Abstract
This document guides you through setting up the required components in small
 steps with immediate incentives â€“ leading up to a complete example demo
 with timing done via the Rocket editor.
 To get started, first read the guide to the document section to find your
 way around.
 Then go and make a demo about it!
\begin_inset VSpace bigskip
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename haujobb.jpg
	scale 87
	BoundingBox 0bp 96bp 1024bp 669bp
	clip

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Setup
\end_layout

\begin_layout Standard
The Haujobb Amiga Framework facilitates modern Amiga demo making on several
 levels.
\end_layout

\begin_layout Standard
On its lowest level, WickedOS, it provides with you with an API for assembly-lev
el access to over 20 different chunky to planar based screenmodes, several
 music replayers, and interrupt hooks.
 You can choose from using a multi-tasking-friendly hardware abstraction
 layer, or a traditional multi-tasking-killer mode.
 WickedOS has been used in a number of our Amiga demos, ranging from 
\emph on
Mnemonics
\emph default
 to 
\emph on
Beam Riders
\emph default
.
 By default it targets 
\begin_inset Quotes eld
\end_inset

todays
\begin_inset Quotes erd
\end_inset

 68060 AGA demos, i.e.
 having an FPU and at least a 68020 or better CPU in the target machine.
\end_layout

\begin_layout Standard
On a higher level, the framework allows you to mix assembler and C-code.
 Furthermore, it provides you with a reimplementation of the WickedOS-API
 in Qt, This allows for developing and debugging effects natively on the
 PC, before cross-compiling (and further optimizing) them for the Amiga.
\end_layout

\begin_layout Section
Guide to the document
\end_layout

\begin_layout Standard
This document tries to document to entire framework, which includes working
 on the PC and well as on the Amiga (with different tools).
\end_layout

\begin_layout Standard
If you just wanted to have a quick start on your PC, read the Quickstart
 section 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Summary-(TL;DR)"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
If you also wanted to set up assembler, C-compiler and linker on the Amiga,
 start reading at that chapter 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "sec:Assembler-and-Linker"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Please note that albeit those tools work perfectly fine on Amiga, we are
 not supporting them fully with our makefiles.
\end_layout

\begin_layout Standard
If you were really curious and also wanted to play around with WickedOS
 using Asm-One and Devpac, you could read the corresponding section 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "sec:WickedOS"
plural "false"
caps "false"
noprefix "false"

\end_inset

 in the annex.
\end_layout

\begin_layout Standard
In any case, once you installed the assembler, compiler, linker and make
 tools, you should first check out the Hello World example 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Example:-Hello-world"
plural "false"
caps "false"
noprefix "false"

\end_inset

, before following the rest of the examples, which are described in Part
 II of this document, starting 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "part:Demomaking"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Subsection
Resources
\end_layout

\begin_layout Standard
The complete sources are available at 
\begin_inset CommandInset href
LatexCommand href
name "https://github.com/leifo/haujobb-amiga"
target "https://github.com/leifo/haujobb-amiga"
literal "false"

\end_inset

.
 The documentation is hosted at 
\begin_inset CommandInset href
LatexCommand href
name "http://www.dig-id.de/amiga/framework/"
target "http://www.dig-id.de/amiga/framework/"
literal "false"

\end_inset

, PDF-version at 
\begin_inset CommandInset href
LatexCommand href
name "http://www.dig-id.de/amiga/framework/haf.pdf"
target "http://www.dig-id.de/amiga/framework/haf.pdf"
literal "false"

\end_inset

.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Summary-(TL;DR)"

\end_inset

Quickstart (TL;DR)
\end_layout

\begin_layout Standard
The Haujobb Amiga Framework supports development of Amiga demos on PC, and
 then cross-compiling them for the Amiga.You probably didn't want to compile
 and assemble on the Amiga anyway, so you just:
\end_layout

\begin_layout Itemize
set up the vbcc cross-compiler for Windows using 
\begin_inset CommandInset href
LatexCommand href
name "Install-VBCC.exe"
target "http://server.owl.de/~frank/vbcc/2017-05-18/Install-VBCC.exe"
literal "false"

\end_inset

 (to c:
\backslash
vbcc), as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:vbcc-setup-on"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
you could then 
\emph on
cd
\emph default
 to the root folder 
\emph on
haujobb-amiga
\emph default
 and type 
\emph on
make
\emph default
 to build the whole Amiga side from scratch
\end_layout

\end_deeper
\begin_layout Itemize
set up a shared folder on your PC or NAS that could be reached from your
 real or emulated Amiga, as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Shared-Folders-between"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Itemize
installed Visual Studio, at least 2010, but probably the latest 2017 Community
 edition, as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Visual-Studio"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Itemize
installed Qt5, Qt Creator, and cdb debugger support, as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Qt-Creator"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Itemize
and then double-checked that compiler, debugger, and Qt version were correctly
 set up as a 
\emph on
kit
\emph default
, as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Kit-Setup"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Standard
This is all that needed to be done, so you could now open our supplied example
 project files (*.pro) in the 
\emph on
/demo
\emph default
 folder and start making Amiga demos on PC.
 If you find any issues, please report them on 
\begin_inset CommandInset href
LatexCommand href
name "GitHub"
target "https://github.com/leifo/haujobb-amiga/issues"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
Enjoy!
\end_layout

\begin_layout Section
Assembler and Linker Setup
\begin_inset CommandInset label
LatexCommand label
name "sec:Assembler-and-Linker"

\end_inset


\end_layout

\begin_layout Standard
Traditionally, many Amiga-demos were made using ASM-One, or one of its derivates.
 I have personally worked with ASM-One v1.29 for many years, and demos like
 Mnemonics were made almost exclusively with that assembler, while other
 parts relied on genam from the Devpac 3.04 package.
 To honor that tradition, WickedOS stays fully compatible with ASM-One and
 Devpac.
 But, more importantly, it can also be used with tools like vasm and vlink,
 both natively on the Amiga, and for cross-compiling on the PC.
\end_layout

\begin_layout Standard
This setup chapter will take you on a quick tour through the different component
s that are required to get you up and running step by step.
 
\end_layout

\begin_layout Standard
To get started, grab the release archive of our framework from GitHub at
 
\begin_inset CommandInset href
LatexCommand href
name "https://github.com/leifo/haujobb-amiga"
target "https://github.com/leifo/haujobb-amiga"
literal "false"

\end_inset

.
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Subsection
Includes from NDK
\end_layout

\begin_layout Standard
First of all, you need to have the assembler include-files available at
 
\begin_inset Quotes eld
\end_inset

INCLUDES:
\begin_inset Quotes erd
\end_inset

.
 WickedOS doesn't need the latest features of AmigaOS, so it is likely to
 work with the includes that you might already have.
 If not, do as follows.
\end_layout

\begin_layout Standard
Obtain a copy of the latest AmigaOS Native Developer Kit (NDK).
 At the time of writing this was version 3.9 and it was still available at
 
\begin_inset CommandInset href
LatexCommand href
name "www.haage-partner.de/download/AmigaOS/NDK39.lha"
target "http://www.haage-partner.de/download/AmigaOS/NDK39.lha"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
Unpack the archive on your Amiga
\end_layout

\begin_layout Enumerate
Assign 
\begin_inset Quotes eld
\end_inset

INCLUDES:
\begin_inset Quotes erd
\end_inset

 <whereYouUnpackedIt>/Include/include_i
\end_layout

\begin_layout Enumerate
List includes:hardware/custom.i (should list a file, mine is 3045 bytes long)
\end_layout

\begin_layout Enumerate
Consider putting the assign from line 2 into s:user-startup (optional, but
 you must provide the assign to INCLUDES: if you plan to assemble WickedOS
 on Amiga).
\end_layout

\begin_layout Subsection
vasm and vlink
\end_layout

\begin_layout Standard
We can now use 
\emph on
vasm
\emph default
 to assemble the WickedOS source into a linkable binary object (.o) file,
 and then link that into an executable file using 
\emph on
vlink
\emph default
.
 These portable command-line tools are at the core of our strategy for cross-dev
elopment, together with vmake and vbcc, which will be covered later in this
 document.
 
\end_layout

\begin_layout Standard
The project homepages are at 
\begin_inset CommandInset href
LatexCommand href
name "http://sun.hasenbraten.de/vasm/"
target "http://sun.hasenbraten.de/vasm/"
literal "false"

\end_inset

and 
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
target "http://sun.hasenbraten.de/vlink/"
literal "false"

\end_inset

.
 You can get the binaries, sources, as well as complete documentation for
 both tools at their respective homepages.
\end_layout

\begin_layout Standard
The supplied WickedOS source assembles out of the box on Amiga and PC.
 The following sections show you how to do it.
\end_layout

\begin_layout Standard
To assembe on the Amiga, get the latest release binaries from
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
target "http://sun.hasenbraten.de/vasm/bin/rel/vasmm68k_mot_os3.lha"
literal "false"

\end_inset


\end_layout

\begin_layout Itemize
and 
\begin_inset CommandInset href
LatexCommand href
target "http://sun.hasenbraten.de/vlink/bin/rel/vlink_AmigaM68k.lha"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Copy the contained files vasmm68k_mot and vlink to your path (e.g.
 to 
\begin_inset Quotes eld
\end_inset

C:
\begin_inset Quotes erd
\end_inset

).
 Confirm that they are working by typing:
\end_layout

\begin_layout Itemize
vlink -v
\end_layout

\begin_layout Itemize
vasmm68k_mot
\end_layout

\begin_layout Standard
The output version numbers should somehow match those that are mentioned
 on the project homepages.
 Note that vasm is not only portable, i.e.
 ready to make work on different plattforms, but also retargetable, i.e.
 able to assemble sources for different target CPUs with different syntax
 modules.
 Shortcodes for the latter two are automatically appended to the binary
 executable name.
 Although many different versions of vasm exist, we are only interested
 in the 68k_mot version.
 If you are like me and like shorter names, you can add 
\begin_inset Quotes eld
\end_inset

alias vasm vasmm68k_mot
\begin_inset Quotes erd
\end_inset

 to your s:user-startup to make your life a little bit easier once in a
 while.
\end_layout

\begin_layout Subsection
Example: Wostest
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "Built-In-Example-With-vasm-and-vlink"

\end_inset

With vasm and vlink in place, you can already assemble, link and execute
 the built-in example like this:
\end_layout

\begin_layout Enumerate
cd WOS:
\end_layout

\begin_layout Enumerate
execute buildwostest.bat
\end_layout

\begin_layout Enumerate
wostest
\end_layout

\begin_layout Standard
This procedure should build and run an example screen.
 See the screenshot for a typical output of the shell and of 
\emph on
wostest
\emph default
.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename wostest.png

\end_inset


\begin_inset Graphics
	filename hautjob.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Wostest assembled on Amiga, output
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
vasm and vlink are called from buildwostest.bat, which contains only two
 lines.
 Let's look at them in more detail:
\end_layout

\begin_layout LyX-Code
vasmm68k_mot -Fhunk -m68020 -m68882 wos_v1.63.s -o wostest.o 
\end_layout

\begin_layout LyX-Code
  -Ic:/vbcc/NDK39/Include/include_i -DWTEST
\end_layout

\begin_layout LyX-Code
vlink wostest.o -o wostest
\end_layout

\begin_layout Standard
The vasm-line specifies a number of things about our source and target binary
 via these parameters:
\end_layout

\begin_layout Itemize
-F: the output format should be (Amiga) hunk
\end_layout

\begin_layout Itemize
-m68020/m68882: the source contains 68020 CPU and 68882 FPU commands (this
 defines the base-level and is also okay if we really want to target 68060)
\end_layout

\begin_layout Itemize
-o: the assembled file should be written to a linkable object named wostest.o
\end_layout

\begin_layout Itemize
-D: Define a flag (here 
\begin_inset Quotes eld
\end_inset

WTEST
\begin_inset Quotes erd
\end_inset

, which causes the conditional-assembly of the built-in example) 
\end_layout

\begin_layout Itemize
-I: additional Include path at 
\begin_inset Quotes eld
\end_inset

c:/vbcc/targets/NDK39/Include/include_i
\begin_inset Quotes erd
\end_inset

 (as created by the Windows installer, c.f.
 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "sec:Compiler-Setup"
plural "false"
caps "false"
noprefix "false"

\end_inset

)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
Note that this path is searched first, but not found on Amiga, since it
 is a PC-style path, and thus disregarded silently.
\end_layout

\begin_layout Itemize
vasm thus falls back to using the 
\begin_inset Quotes eld
\end_inset

incdir INCLUDES:
\begin_inset Quotes erd
\end_inset

 directives that are contained in the source.
\end_layout

\begin_layout Itemize
if you preferred, you could actually remove the assign INCLUDES: and point
 to the corresponding directory via the -I parameter.
 
\end_layout

\end_deeper
\begin_layout Standard
Finally, the vlink-line takes the output-file generated by vasm, wostest.o,
 and turns it into an executable file, 
\emph on
wostest
\emph default
.
\end_layout

\begin_layout Subsection
Assembling on PC
\end_layout

\begin_layout Standard
Windows binaries of vasm, vlink and make are shipped together with the vbcc-comp
iler which can be obtained from 
\begin_inset CommandInset href
LatexCommand href
name "http://sun.hasenbraten.de/vbcc/"
target "http://sun.hasenbraten.de/vbcc/"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Download and run 
\begin_inset CommandInset href
LatexCommand href
name "Install-VBCC.exe"
target "http://server.owl.de/~frank/vbcc/2017-05-18/Install-VBCC.exe"
literal "false"

\end_inset

, as decribed 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "sec:Compiler-Setup"
plural "false"
caps "false"
noprefix "false"

\end_inset

 in more detail.
 Please skip to that page.
 Then come back and confirm that the tools are working by opening a command
 prompt and typing:
\end_layout

\begin_layout Itemize
vlink -v
\end_layout

\begin_layout Itemize
vasmm68k_mot
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename wostest-pc.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Wostest assembled on PC
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
With vasmm68k_mot and vlink in place, you can then just:
\end_layout

\begin_layout Enumerate
cd 
\emph on
<to the directory where you unpacked WickedOS on PC> 
\emph default
(here: t:
\backslash
wos)
\end_layout

\begin_layout Enumerate
type 
\begin_inset Quotes eld
\end_inset

buildwostest.bat
\begin_inset Quotes erd
\end_inset

 to cross-assemble and link 
\emph on
wostest
\emph default
 on the PC
\end_layout

\begin_layout Standard
Note that the binary output produced on the PC is exactly the same as on
 the Amiga, of course.
 Also note that this worked in a fraction of the time that it took on the
 Amiga.
 Yes, it was really
\emph on
 that fast
\emph default
.
 Welcome to Modern Amiga Demo Cross-Development!
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Shared-Folders-between"

\end_inset

Shared Folders between Amiga and PC
\end_layout

\begin_layout Standard
Now that you cross-compiled an Amiga executable blazingly fast on your PC,
 you wouldn't want to waste any time getting it onto your Amiga for testing
 it, would you? So manual file-copying via FTP, CF-cards, or by other means
 is not going to be fast enough for quick turn-around times.
 Your ideal setup depends on whether you want to work with emulated or real
 Amigas, or both.
\end_layout

\begin_layout Paragraph
Emulators
\end_layout

\begin_layout Standard
like WinUAE allow adding a folder from the host-computer as a volume on
 the emulated Amiga.
 Do yourself a favour and use this feature!
\end_layout

\begin_layout Standard
I personally mounted a volume 
\begin_inset Quotes eld
\end_inset

WIP:
\begin_inset Quotes erd
\end_inset

 (as in Work In Progress) from a folder that I mounted from a Network Attached
 Storage (NAS, a Synology here) on the PC.
 This is because...
\end_layout

\begin_layout Paragraph
Real Amigas 
\end_layout

\begin_layout Standard
cannot just mount your Windows folders.
 NAS folders, on the other hand, are made to be mountable, and can also
 easily be mounted on Amigas that have:
\end_layout

\begin_layout Itemize
some Fast-RAM
\end_layout

\begin_layout Itemize
a TCP/IP stack, like AmiTCP, Genesis, Miami, or Roadshow
\end_layout

\begin_layout Itemize
a SMB file system client like smbfs (try 
\begin_inset CommandInset href
LatexCommand href
name "Aminet"
target "http://aminet.net/package/comm/tcp/smbfs-68k"
literal "false"

\end_inset

, although the version 1.74 hosted there is currently horribly outdated)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
I am using Roadshow and just had to add the following line to s:Network-Startup
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
smbfs domain=workgroup user=username password=password
\end_layout

\begin_layout LyX-Code
      volume=NAS service=//diskstation/files/amiga
\end_layout

\end_deeper
\end_deeper
\begin_layout Paragraph
PC-Ramdisks
\end_layout

\begin_layout Standard
are a fact.
 Yes, they do exist! Even though they are not shipped as part of the Windows
 operating system, like on Amiga, you can easily download and install very
 powerful third-party components.
 And PC-based Ramdisks are just as useful as they have always been on Amigas.
 This is what I did:
\end_layout

\begin_layout Enumerate
Download and install 
\begin_inset CommandInset href
LatexCommand href
name "ImDisk Virtual Disk Driver"
target "http://www.ltr-data.se/opencode.html/#ImDisk"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
Configure a Drive Letter 
\begin_inset Quotes eld
\end_inset

T:
\begin_inset Quotes erd
\end_inset

 with a 2 GB RamDisk using File System 
\begin_inset Quotes eld
\end_inset

NTFS
\begin_inset Quotes erd
\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
check: 
\begin_inset Quotes eld
\end_inset

Allocate Memory Dynamically
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

Launch at Windows Startup
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Enumerate
uncheck: 
\begin_inset Quotes eld
\end_inset

Create TEMP Folder
\begin_inset Quotes erd
\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Mount that folder as 
\begin_inset Quotes eld
\end_inset

PCT:
\begin_inset Quotes erd
\end_inset

 in WinUAE (very useful for quick data exchange, esp.
 downloads)
\end_layout

\begin_layout Section
Compiler Setup
\end_layout

\begin_layout Standard
When planning to develop Amiga software with the C programming language,
 there are a number of C-Compilers to choose from.
 Most notably they are:
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
name "SAS/C"
target "http://www.pjhutchison.org/tutorial/sas_c.html"
literal "false"

\end_inset

, which is 
\emph on
the
\emph default
 Amiga standard programming environment (commercial and deprecated)
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
name "GCC"
target "https://github.com/bebbo/amiga-gcc"
literal "false"

\end_inset

, which is 
\emph on
the
\emph default
 cross-plattform standard (free and open source)
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
name "Storm C"
target "http://www.haage-partner.de/amiga/storm/sc_e.htm"
literal "false"

\end_inset

, an Amiga programming environment based on an old version of GCC (commercial)
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
name "DICE"
target "http://aminet.net/package/dev/c/dice-3.16"
literal "false"

\end_inset

, which was a popular and inexpensive Amiga programming environment (recently
 open sourced)
\end_layout

\begin_layout Itemize
\begin_inset CommandInset href
LatexCommand href
name "vbcc"
target "http://sun.hasenbraten.de/vbcc/"
literal "false"

\end_inset

, which is an actively maintained cross-plattform compiler (free and open
 source)
\end_layout

\begin_layout Standard
As we were looking for a cross-compiling solution, SAS/C, Storm C and DICE
 were no options.
 They are also neither free and open source, nor actively maintained, which
 was our second selection-criteria.
 This left us to decide between GCC and vbcc.
 At the time when we made our decision in 2009/2010, the Amiga-port of GCC
 was lacking behind in version numbers, while vbcc was the relatively new
 thing that was used by several Amiga-coders, and personally recommended
 by Kalms of TBL.
 It also allows for writing inline-assembly in the familiar Motoral syntax,
 rather than the more alien GCC Assembler syntax.
\end_layout

\begin_layout Standard
Moreover, vbcc is designed to work in combination with vasm and vlink from
 the same authors.
 The maintainer of the Amiga bindings, Frank Wille, is one of the most experienc
ed and longest standing developers of quality Amiga development tools, ranging
 back to at least 1991 (with his 
\begin_inset CommandInset href
LatexCommand href
name "PhxAss"
target "http://royal.owl.de/~frank/phxass.html"
literal "false"

\end_inset

and 
\begin_inset CommandInset href
LatexCommand href
name "PxhLnk"
target "http://royal.owl.de/~frank/phxlnk.html"
literal "false"

\end_inset

).
 This long-term experience and continued commitment ensures first class
 Amiga support.
 
\end_layout

\begin_layout Standard
Hence, we decided to use vbcc as our C-compiler.
 The vbcc project homepage is located at 
\begin_inset CommandInset href
LatexCommand href
target "http://sun.hasenbraten.de/vbcc/"

\end_inset

.
 There you can get the binaries, targets, sources, and complete documentation.
\end_layout

\begin_layout Subsection
vbcc setup on Amiga
\end_layout

\begin_layout Standard
Installation on Amiga is easy.
 Citing the 
\begin_inset CommandInset href
LatexCommand href
name "vbcc download instructions"
target "http://sun.hasenbraten.de/vbcc/index.php?view=download"
literal "false"

\end_inset

:
\end_layout

\begin_layout Quotation
You need to pick the appropriate binary archive for your host platform.
 Then you can add as many target archives as you need.
 [..] Install the binary archive first, using the provided Amiga installer,
 then add the targets.
\end_layout

\begin_layout Standard
So, download and install:
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset href
LatexCommand href
name "AmigaOS 2.x/3.x 68020+ binaries"
target "http://server.owl.de/~frank/vbcc/current/vbcc_bin_amigaos68k.lha"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset CommandInset href
LatexCommand href
name "Compiler target AmigaOS 2.x/3.x M680x0"
target "http://server.owl.de/~frank/vbcc/current/vbcc_target_m68k-amigaos.lha"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
The archives contain standard Amiga Installer scripts.
 Run them.
 Then test if the following commands are available:
\end_layout

\begin_layout Enumerate
vc
\end_layout

\begin_layout Enumerate
vbccm68k
\end_layout

\begin_layout Standard
The former is a frontend for the latter and is very handy, if you are planning
 to use the C-compiler on the Amiga..
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:vbcc-setup-on"

\end_inset

vbcc setup on PC
\end_layout

\begin_layout Standard
Installation on PC is even easier.
 
\begin_inset CommandInset label
LatexCommand label
name "sec:Compiler-Setup"

\end_inset

Basically, just download and install a single file from the 
\begin_inset CommandInset href
LatexCommand href
name "vbcc homepage"
target "http://sun.hasenbraten.de/vbcc/index.php"
literal "false"

\end_inset

.
 But be aware that the download is falsely reported to be a infected by
 malware by several virus scanners! Therefore:
\end_layout

\begin_layout Enumerate
Disable your virus-checker (optional)
\end_layout

\begin_layout Enumerate
Download and install 
\begin_inset CommandInset href
LatexCommand href
name "Install-VBCC.exe"
target "http://server.owl.de/~frank/vbcc/2017-05-18/Install-VBCC.exe"
literal "false"

\end_inset

 with these settings
\end_layout

\begin_deeper
\begin_layout Enumerate
Leave 
\begin_inset Quotes eld
\end_inset

Default compiler target
\begin_inset Quotes erd
\end_inset

 as 
\emph on
AmigaOS 2.0
\end_layout

\begin_layout Enumerate
Change path (below) to C:
\backslash
vbcc
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename install-vbcc.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
VBCC Installer for Windows
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Enable your virus-checker again.
 If your were curious about this installer, you could:
\end_layout

\begin_deeper
\begin_layout Enumerate
check the sources at 
\begin_inset CommandInset href
LatexCommand href
name "GitHub"
target "https://github.com/leffmann/vbcc-windows"
literal "false"

\end_inset

 
\end_layout

\begin_layout Enumerate
follow the thread 
\begin_inset CommandInset href
LatexCommand href
name "Windows installer for VBCC tool chain"
target "http://eab.abime.net/showthread.php?t=83113"
literal "false"

\end_inset

 at the English Amiga Board
\end_layout

\begin_layout Enumerate
or believe us that it is fine.
\end_layout

\end_deeper
\begin_layout Standard
The good news is that you are already done! Open a new command prompt and
 test that the following commands are available:
\end_layout

\begin_layout Enumerate
vc
\end_layout

\begin_layout Enumerate
vbccm68k
\end_layout

\begin_layout Enumerate
vasmm68k_mot
\end_layout

\begin_layout Enumerate
vlink
\end_layout

\begin_layout Enumerate
make
\end_layout

\begin_layout Subsection
Example: Hello world
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example:-Hello-world"

\end_inset


\end_layout

\begin_layout Standard
Let's compile our first C-source with this setup! The following procedure
 should work on the Amiga aas well as on the PC side.
\end_layout

\begin_layout Enumerate
cd to the /demo/helloworld folder
\end_layout

\begin_layout Enumerate
vc hello.c
\end_layout

\begin_deeper
\begin_layout Enumerate
this should generate an Amiga executable 
\begin_inset Quotes eld
\end_inset

a.out
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Enumerate
alternatively provide a filename with: vc hello.c -o hello
\end_layout

\end_deeper
\begin_layout Enumerate
Run the freshly compiled executable on Amiga.
\end_layout

\begin_layout Standard
For completeness, this is the full source of hello.c
\end_layout

\begin_layout LyX-Code
/* hello world, noname, 23.10.18 
\end_layout

\begin_layout LyX-Code
   compile with: 
\end_layout

\begin_layout LyX-Code
   - "vc hello.c" (compiles to file a.out)
\end_layout

\begin_layout LyX-Code
   - or "vc +aos68k hello.c -o hello" (being more explicit about what we
 want)
\end_layout

\begin_layout LyX-Code
   - or "vc +aos68k hello.c -o hello -v" (to see commands as called by vc)
\end_layout

\begin_layout LyX-Code
   - or "make" (using makefile)
\end_layout

\begin_layout LyX-Code
*/
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
#include <stdio.h>
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
int main(int argc, char **argv)
\end_layout

\begin_layout LyX-Code
{
\end_layout

\begin_deeper
\begin_layout LyX-Code
int i; 
\end_layout

\begin_layout LyX-Code
if (argc==1)
\end_layout

\begin_layout LyX-Code
{
\end_layout

\begin_deeper
\begin_layout LyX-Code
/* no args */ 
\end_layout

\begin_layout LyX-Code
printf("Hello, world!
\backslash
n"); /* argv[0] is always the filename */
\end_layout

\begin_layout LyX-Code
printf("Called from filename: %s
\backslash
n", argv[0]);
\end_layout

\end_deeper
\begin_layout LyX-Code
}else{
\end_layout

\begin_deeper
\begin_layout LyX-Code
/* arguments given, start at argv[1] */
\end_layout

\begin_layout LyX-Code
printf("Hello");
\end_layout

\begin_layout LyX-Code
for (i=1; i<argc; i++)
\end_layout

\begin_layout LyX-Code
{ 
\end_layout

\begin_deeper
\begin_layout LyX-Code
printf(", %s",argv[i]); 
\end_layout

\end_deeper
\begin_layout LyX-Code
} 
\end_layout

\begin_layout LyX-Code
printf("!
\backslash
n"); 
\end_layout

\end_deeper
\begin_layout LyX-Code
}
\end_layout

\begin_layout LyX-Code
return 0; 
\end_layout

\end_deeper
\begin_layout LyX-Code
} 
\end_layout

\begin_layout Standard
This is slightly extended hello world that also makes use of the provided
 arguments (i.e.
 argc and argv).
 You can also build the binary by executing build.bat.
 This example also comes with a simple makefile.
 But in order to build it from there, you first have to install make itself.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:GNU-make"

\end_inset

GNU make
\end_layout

\begin_layout Standard
While using batch-files for scripting repetetive tasks is useful, you are
 quickly hitting the roof with that approach.
 Which files need to be built, and how? This is where makefiles and make
 come into play.
 They coordinate the software build process in a structured way.
 Required tools, source-files, and libraries are listed in the makefile.
 Based on the rules that are also noted in the makefile, the make-tool then
 coordinates the build-process, i.e.
 turning source-code into an executable file.
\end_layout

\begin_layout Standard
We are using GNU make for building the Amiga target, as it is a free standard
 tool that is available on both Amiga and current plattforms.
 It is your choice to install it on Amiga and/or PC.
 The forthfollowing test should run on both platforms.
\end_layout

\begin_layout Subsection
Configuring make on Amiga
\end_layout

\begin_layout Enumerate
Get a native Amiga binary from: 
\begin_inset CommandInset href
LatexCommand href
name "http://aminet.net/package/dev/c/make-3.75-bin"
target "http://aminet.net/package/dev/c/make-3.75-bin"
literal "true"

\end_inset

 and put it to your path
\end_layout

\begin_deeper
\begin_layout Enumerate
Please note that the v3.75 from Aminet is in fact a v3.74 ported natively
 for Amiga.
 The author just bumped the version number for his efforts.
\end_layout

\begin_layout Enumerate
Open a newshell and type 
\begin_inset Quotes eld
\end_inset

make -v
\begin_inset Quotes erd
\end_inset

 to check that make is working
\end_layout

\begin_deeper
\begin_layout Enumerate
it should show you its version number.
\end_layout

\begin_layout Enumerate
In case you get a stack overflow warning type 
\begin_inset Quotes eld
\end_inset

stack 20000
\begin_inset Quotes erd
\end_inset

 and try again
\end_layout

\end_deeper
\end_deeper
\begin_layout Subsection
Configuring make on PC
\end_layout

\begin_layout Enumerate
Make is bundled and installed with 
\begin_inset CommandInset href
LatexCommand href
name "Install-VBCC.exe"
target "http://server.owl.de/~frank/vbcc/2017-05-18/Install-VBCC.exe"
literal "false"

\end_inset

, as described
\begin_inset CommandInset ref
LatexCommand vpageref
reference "sec:Compiler-Setup"
plural "false"
caps "false"
noprefix "false"

\end_inset

 (v4.2.90 at the time of writing).
 Thus you should have already installed it.
\end_layout

\begin_deeper
\begin_layout Enumerate
This is the preferred version
\end_layout

\begin_layout Enumerate
Alternatively, older Windows binaries can be obtained from:
\begin_inset Newline newline
\end_inset

\SpecialChar allowbreak

\begin_inset CommandInset href
LatexCommand href
name "http://gnuwin32.sourceforge.net/packages/make.htm"
target "http://gnuwin32.sourceforge.net/packages/make.htm"
literal "true"

\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Open a command prompt and type 
\begin_inset Quotes eld
\end_inset

make -v
\begin_inset Quotes erd
\end_inset

 to check that it is working
\end_layout

\begin_deeper
\begin_layout Enumerate
make should show you its version number.
\end_layout

\end_deeper
\begin_layout Subsection

\series medium
Building the WickedOS C2P-converters
\end_layout

\begin_layout Standard
We are aiming to use make on both Amiga and PC.
 Test that it works for you in two steps:
\end_layout

\begin_layout Enumerate
Use it to assemble a bunch of real world assembler files with a given makefile
\end_layout

\begin_deeper
\begin_layout Enumerate
cd to /sub 
\end_layout

\begin_layout Enumerate
make
\end_layout

\end_deeper
\begin_layout Standard
This should call vasm on about two dozen assembly-files from the /chunky
 subfolder and generate the same number of *.bin files.
 These files are the actual chunky to planar (C2P) converters for WickedOS'
 different screenmodes.
 If the distribution archive came only with one bin-file (for screenmode
 #1, as used in the initial example), you have now enabled the rest of them.
 Congratulations, well done! 
\end_layout

\begin_layout Subsection
Cleaning with rm
\end_layout

\begin_layout Standard
After work comes the clean-up! For make this is 
\begin_inset Quotes eld
\end_inset

make clean
\begin_inset Quotes erd
\end_inset

 which usually deletes a bunch of assembled or compiled binary object files
 and needs a delete command in order to work.
 Unfortunately, these delete commands differ between operating systems,
 not only by name, but also by syntax.
 In order to keep at least a somehow coherent structure, we define as per
 convention that a command 
\begin_inset Quotes eld
\end_inset

rm
\begin_inset Quotes erd
\end_inset

 should be reachable and work like rm from GNU coreutils.
\end_layout

\begin_layout Subsubsection
On Amiga
\end_layout

\begin_layout Standard
Just add another line to s:user-startup: 
\begin_inset Quotes eld
\end_inset

alias rm delete
\begin_inset Quotes erd
\end_inset

.
 Please note that this is not ideal but will work reasonably well for small
 projects, as long as the command-line does not get too long.
 Unfortunately, the command-line of the C2P-converter example with over
 20 entries is already exceeding those limits.
 Mea culpa!
\end_layout

\begin_layout Subsubsection
On PC
\end_layout

\begin_layout Standard
Windows del is not good enough for our purposes! Therefore we are using
 rm from GNU coreutils, a.k.a.
 fileutils.
\end_layout

\begin_layout Enumerate
Get the latest binaries from
\begin_inset Newline newline
\end_inset

 
\begin_inset CommandInset href
LatexCommand href
target "http://gnuwin32.sourceforge.net/packages/coreutils.htm"

\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
either choose the setup file, or just the binary.zip
\end_layout

\end_deeper
\begin_layout Enumerate
At your discretion, install all the tools, or just copy rm.exe from the bin-folde
r in the zip-file to your path
\end_layout

\begin_deeper
\begin_layout Enumerate
it is suggested to copy rm to c:
\backslash
vbcc
\backslash
bin
\end_layout

\begin_layout Enumerate
in case you choose the file from the zip-file, add missing dependencies
 from 
\begin_inset CommandInset href
LatexCommand href
name "coreutils-dep-zip"
target "http://gnuwin32.sourceforge.net/downlinks/coreutils-dep-zip.php"
literal "false"

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Open a command prompt and type 
\begin_inset Quotes eld
\end_inset

rm --help
\begin_inset Quotes erd
\end_inset

 to check if it is working
\end_layout

\begin_layout Enumerate
Finally, try it in combination with make
\end_layout

\begin_deeper
\begin_layout Enumerate
cd to the /sub directory again
\end_layout

\begin_layout Enumerate
type 
\begin_inset Quotes eld
\end_inset

make
\begin_inset Quotes erd
\end_inset

 and it should tell you 
\begin_inset Quotes eld
\end_inset

Nothing to be done for `all'
\begin_inset Quotes erd
\end_inset

 which means that all assembled filed were up-to-date.
\end_layout

\begin_layout Enumerate
type 
\begin_inset Quotes eld
\end_inset

make clean
\begin_inset Quotes erd
\end_inset

 to remove those files
\end_layout

\begin_layout Enumerate
type 
\begin_inset Quotes eld
\end_inset

make
\begin_inset Quotes erd
\end_inset

 again and see it rebuild.
\end_layout

\end_deeper
\begin_layout Standard
This concludes the setup of the Amiga-oriented tools.
 
\end_layout

\begin_layout Section
PC-Prototyping Environment
\end_layout

\begin_layout Standard
A large part of the productivity-benefits of our toolchain stem from the
 use of a native PC-build while prototyping the effects and editing the
 demo.
 This takes cross-compilation out of the picture for a period of time and
 allows you to focus on getting something on screen, debugging it, and then
 making it look nice before focussing again on making it all run smoothly
 on the Amiga.
 It also allows you to exploit the PC-hardware that you own anyway for your
 own sanity, e.g.
 use your big monitor wisely and fill it with a modern IDE with syntax-coloring,
 code-completion, code-navigation, project support, and of course debugging
 facilities.
 And run all of this natively on your modern multi-core CPU to save time
 and keep you in the flow.
\end_layout

\begin_layout Standard
For this to work you need a compiler, an IDE, and a debugger.
 While in theory these components would all be included in the popular Microsoft
 Visual Studio, we have blended it in our toolchain with QtCreator as the
 IDE component.
 While this was mainly a simple personal preference for a nice IDE that
 can work with different compilers, it also kept our toolchain itself plattform
 independant! QtCreator is available for Windows, macOS, and Linux.
 For the latter two, you would be able to set it up with gcc.
 For Windows, you best use it in combination with Microsoft's compiler.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Visual-Studio"

\end_inset

Visual Studio
\end_layout

\begin_layout Standard
Let's start with installing 
\begin_inset CommandInset href
LatexCommand href
name "Microsoft Visual Studio"
target "https://en.wikipedia.org/wiki/Microsoft_Visual_Studio"
literal "false"

\end_inset

 (MSVC), which comes in many different versions over the years (see table).
 The oldest one that we have personally tested is 2010.
 If you already have Visual Studio installed in a least that version, you
 can skip this section.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Visual Studio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2010
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2012
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2013
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2015
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2017
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pro
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
not tested
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
not tested
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
not tested
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Community
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
not tested
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OK
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OK
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Supported Microsoft Visual Studio versions
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
While Visual Studio was, and still is, a full-price commercial product,
 Microsoft has launched a number of free (as in beer) editions over the
 years.
 The Express edition introduced in 2005 has long since been discontinued
 and is now superseded by the Community edition.
 Visual Studio Community 2017 will work well for us.
 Please download it from 
\begin_inset CommandInset href
LatexCommand href
name "https://visualstudio.microsoft.com"
target "https://visualstudio.microsoft.com"
literal "false"

\end_inset

 and then install it on your Windows machine.
 
\end_layout

\begin_layout Standard
With Visual Studio Community 2017, please also install the missing standard
 headers by selecting 
\emph on
Windows Universal CRT SDK
\emph default
 under 
\emph on
Individual Components -> Compiler, Buildtools and Runtimes
\emph default
, as described 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Missing-Standard-Headers"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Qt-Creator"

\end_inset

Qt Creator
\end_layout

\begin_layout Standard
Now let't install Qt and Qt Creator.
 The Haujobb Amiga Framework is known to work with Qt4 and Visual Studio
 2010 as the minimum supported versions.
 If you haven't got Qt installed already, head over to 
\begin_inset CommandInset href
LatexCommand href
name "https://www.qt.io/download"
target "https://www.qt.io/download"
literal "false"

\end_inset

, get the Open Source edition installer for Qt5, and run it.
\end_layout

\begin_layout Standard
It features many different options, we don't need all of them.
 Just install the latest available Qt 5.x.y release, as well as QtCreator
 and CDB support from the tools section (see figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Required-Components-from"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename qt5-setup.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Required-Components-from"

\end_inset

Required Components from Qt Open Source Installer
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Please note that the version numbers in the figure will change quickly and
 are already outdated at the time of writing.
 The figure also shows a setup wizard that was run on a machine with MSVC
 2015 32-bit.
 You will need to pick the version that fits your installed compiler.
 It is your choice, to install 32-bit or 64-bit version (if available).
 The default path for installation if C:
\backslash
Qt.
\end_layout

\begin_layout Standard
The official documentation for Qt Creator is at 
\begin_inset CommandInset href
LatexCommand href
name "http://doc.qt.io/qtcreator/"
target "http://doc.qt.io/qtcreator/"
literal "false"

\end_inset

.
\end_layout

\begin_layout Subsection
Debugger (CDB)
\end_layout

\begin_layout Standard
If you want to debug your C-programs in Qt Creator, you need to setup the
 CDB debugger.
 The official documentation for this is 
\begin_inset CommandInset href
LatexCommand href
name "here"
target "http://doc.qt.io/qtcreator/creator-debugger-engines.html#debugging-tools-for-windows"
literal "false"

\end_inset

.
 It boils down to downloading the Windows SDK from 
\begin_inset CommandInset href
LatexCommand href
name "https://developer.microsoft.com/de-de/windows/downloads/windows-10-sdk"
target "https://developer.microsoft.com/de-de/windows/downloads/windows-10-sdk"
literal "false"

\end_inset

.
 Then run the installer and uncheck everything except 
\begin_inset Quotes eld
\end_inset

Debugging Tools for Windows
\begin_inset Quotes erd
\end_inset

 (see figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Debugging-Tools-for"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename winsdk-debugger.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Debugging-Tools-for"

\end_inset

Debugging Tools for Windows from Windows SDK
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Kit-Setup"

\end_inset

Kit Setup
\end_layout

\begin_layout Standard
In Qt Creator, combinations of compiler, debugger, Qt version, and a few
 other things are called a 
\emph on
kit
\emph default
.
 
\end_layout

\begin_layout Standard
We need such a kit in order to work with our supplied project files (stars.pro,
 etc.).
 The full Qt doc for this is at 
\begin_inset CommandInset href
LatexCommand href
name "http://doc.qt.io/qtcreator/creator-configuring-projects.html"
target "http://doc.qt.io/qtcreator/creator-configuring-projects.html"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename qtcreator-debug-compile.png

\end_inset

\SpecialChar softhyphen

\begin_inset Graphics
	filename qtcreator-kits.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Compiler-,-Debugger-,-and"

\end_inset

Compiler-, Debugger-, and Kit-Settings in Qt Creator 4.7
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
When you installed compiler, debugger and Qt as described above, go to menu
 Tools->Options.
 The presented options windows should resemble figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Compiler-,-Debugger-,-and"
plural "false"
caps "false"
noprefix "false"

\end_inset

 (note that it has been taken with an older Windows SDK installed).
 
\end_layout

\begin_layout Standard
Select 
\emph on
Kits
\emph default
 on the left pane.
 Then:
\end_layout

\begin_layout Itemize
check under 
\emph on
Qt Versions
\emph default
 that your installed Qt Version got auto-detected.
 If not, configure it manually.
\end_layout

\begin_layout Itemize
check under 
\emph on
Debuggers
\emph default
 that two versions of cdb.exe (32/64-bit) were found in the Windows Kits
 folder.
\end_layout

\begin_layout Itemize
check under 
\emph on
Compilers
\emph default
 that the Visual C++ compiler was correctly auto-detected.
 Note that the list will usually show several versions ending on something
 like 
\begin_inset Quotes eld
\end_inset

(amd64_x86)
\begin_inset Quotes erd
\end_inset

 meaning that this would be running on a 64-bit machine and generating code
 for a 32-bit machine.
 It usually doesn't matter to our framework if you are selecting a 32-bit
 version or not, as we are not going anywhere near the 32-bit limits, anyway.
 
\end_layout

\begin_layout Itemize
check under 
\emph on
Kits
\emph default
 that you have an auto-detected kit comprising of a 
\emph on
Qt Version
\emph default
, a 
\emph on
Debugger
\emph default
, and a 
\emph on
Compiler
\emph default
.
\end_layout

\begin_layout Itemize
close the Options window, and you should be able to build & run, as well
 as to debug.
\end_layout

\begin_layout Itemize
keep in mind that sometimes you want to 
\end_layout

\begin_deeper
\begin_layout Itemize
run qmake by right-clicking root-element of a project-tree and selecting
 
\emph on
Run qmake
\end_layout

\begin_layout Itemize
and then selecting 
\emph on
Rebuild
\end_layout

\end_deeper
\begin_layout Subsection
Add-Ons
\end_layout

\begin_layout Standard
This section contains a few useful add-ons.
 Install them at your own discretion.
\end_layout

\begin_layout Subsubsection
Syntax Highlighting for M68000 Assembly
\end_layout

\begin_layout Standard
This is really handy if you often work with M68000 assembly files in Qt
 Creator.
 Get 
\begin_inset CommandInset href
LatexCommand href
name "asm-m68k.xml"
target "https://github.com/ricardodovalle/config-qtcreator/blob/master/qtcreator/generic-highlighter/asm-m68k.xml"
literal "false"

\end_inset

 and install it.
 The documentation of 
\emph on
Generic Highlighting
\emph default
 in Qt Creator, as described in 
\begin_inset CommandInset href
LatexCommand href
name "http://doc.qt.io/qtcreator/creator-highlighting.html"
target "http://doc.qt.io/qtcreator/creator-highlighting.html"
literal "false"

\end_inset

 should serve you as a basis.
 On my machine, I just copied the file to the 
\emph on
Fallback Location
\emph default
 (here: C:
\backslash
QtSdk
\backslash
Tools
\backslash
QtCreator
\backslash
share
\backslash
qtcreator
\backslash
generic-highlighter).
\end_layout

\begin_layout Subsubsection
Qt Plug-In for Visual Studio
\end_layout

\begin_layout Standard
If you'd like to use our supplied Qt Creator Project files (*.pro) from within
 Visual Studio, you can install the
\emph on
 Qt Visual Studio Tools 
\emph default
as described 
\begin_inset CommandInset href
LatexCommand href
name "in this blog-post"
target "https://blogs.msdn.microsoft.com/vcblog/2017/04/14/bring-your-existing-qt-projects-to-visual-studio/"
literal "false"

\end_inset

and provided 
\begin_inset CommandInset href
LatexCommand href
name "here"
target "https://marketplace.visualstudio.com/items?itemName=TheQtCompany.QtVisualStudioTools2015"
literal "false"

\end_inset

(for 2015) and 
\begin_inset CommandInset href
LatexCommand href
name "here"
target "https://marketplace.visualstudio.com/items?itemName=TheQtCompany.QtVisualStudioTools-19123"
literal "false"

\end_inset

(for 2017).
 You can also install it via the 
\emph on
marketplace
\emph default
 of Visual Studio.
\end_layout

\begin_layout Standard
Once installed:
\end_layout

\begin_layout Enumerate
Select menu 
\emph on
Qt VS Tools-> Qt Options
\end_layout

\begin_deeper
\begin_layout Enumerate
add your Qt version 
\end_layout

\begin_deeper
\begin_layout Enumerate
the name is automatically provided
\end_layout

\begin_layout Enumerate
just select the path that leads to /bin/qmake under c:
\backslash
Qt
\end_layout

\begin_layout Enumerate
this only works for Qt5 and up
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate
Select menu 
\emph on
Qt VS Tools->Open Qt Project File (.pro)...
\end_layout

\begin_layout Enumerate
Build & Run
\end_layout

\begin_layout Standard
Please note that our IDE of choice is Qt Creator, so if you run into problems
 with Visual Studio, we would be more happy to hear about your solutions,
 and less prepared to help you fix it.
\end_layout

\begin_layout Subsubsection
Symbol Files
\end_layout

\begin_layout Standard
Even though you have already installed a lot of data, the symbol files have
 not been part of it.
 They would usually be loaded on demand over the Internet connection and
 then cached locally.
 If you want to prepare yourself for longer times without Internet, get
 the symbol files.
 You can read more about this topic in 
\begin_inset CommandInset href
LatexCommand href
name "this"
target "https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-symbols"
literal "false"

\end_inset

 article.
 We also have a direct download link somewhere and will add it here at some
 point.
 
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Demomaking
\begin_inset CommandInset label
LatexCommand label
name "part:Demomaking"

\end_inset


\end_layout

\begin_layout Section
Single Examples
\end_layout

\begin_layout Standard
This chapter takes you through the provided examples in order of complexity.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Hello-World"

\end_inset

Hello World
\end_layout

\begin_layout Standard
Let's start with a simple hello world.
 We just want to build and run it from within Qt Creator to confirm that
 everything works.
 
\end_layout

\begin_layout Subsubsection
Overview
\end_layout

\begin_layout Itemize
Open Qt Creator
\end_layout

\begin_layout Itemize
Select menu 
\emph on
File -> Open File or Project ...
 (CTRL-O)
\end_layout

\begin_deeper
\begin_layout Itemize
Open 
\emph on
helloworld.pro
\emph default
 from the
\emph on
 /demo/helloworld
\emph default
 folder
\end_layout

\begin_layout Itemize
alternatively, you can also double-click on a project (*.pro) file in Windows
 Explorer
\end_layout

\end_deeper
\begin_layout Itemize
Upon first start of a project in Qt Creator, select your previously configured
 kit and press
\emph on
 Configure Project
\end_layout

\begin_layout Itemize
Select menu 
\emph on
Build -> Run (CTRL-R)
\end_layout

\begin_layout Standard
You should be presented with a console window and some printed text.
\end_layout

\begin_layout Subsubsection
Discussion
\end_layout

\begin_layout Standard
It couldn't get much simpler than this.
 Basically, just a couple of printf()'s, which require stdio.h.
 If compilation fails for you on that header file, solve the issue now,
 as described 
\begin_inset CommandInset ref
LatexCommand vpageref
reference "subsec:Missing-Standard-Headers"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
The example also shows the use of parameters that are provided to 
\emph on
int main(int argc, char **argv)
\emph default
, with 
\emph on
argc
\emph default
 being the argument count, 
\emph on
argv[0]
\emph default
 the filename, and 
\emph on
argv[1..n]
\emph default
 the supplied arguments, if 
\emph on
argc
\emph default
>1.
\end_layout

\begin_layout Standard
Finally, the project also showcases the need for a shadow-build-subdirectory
 (such as 
\emph on
/build
\emph default
), as Qt Creator calls qmake which creates its own 
\begin_inset Quotes eld
\end_inset

makefile
\begin_inset Quotes erd
\end_inset

-file and thereby overwrites our existing 
\begin_inset Quotes eld
\end_inset

makefile
\begin_inset Quotes erd
\end_inset

 in GNU make syntax 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Missing-Standard-Headers"
plural "false"
caps "false"
noprefix "false"

\end_inset

, which we need to build for Amiga.
 All further examples will thus employ a 
\emph on
/build
\emph default
 folder for the Amiga-specific build files.
\end_layout

\begin_layout Subsection
Stars
\end_layout

\begin_layout Standard
Just a classic star-field.
\end_layout

\begin_layout Subsubsection
Overview
\end_layout

\begin_layout Itemize
Open, configure, build and run 
\emph on
stars.pro
\emph default
 from the 
\emph on
/demo/stars
\emph default
 folder
\end_layout

\begin_layout Standard
You should be presented with a graphics window and some shaded 3D stars
 flying towards you, as show in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Qt-Creator-session"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename qtc-stars.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Qt-Creator-session"

\end_inset

Qt Creator session with project stars
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:StarsDiscussion"

\end_inset

Discussion
\end_layout

\begin_layout Standard
This example does not load any external files.
 The starfield is set up and drawn from a seperate file called starseffect.c
 (with fitting header starseffect.h) which is then called from main.c.
 Keeping the effect-code seperated like this is good practice and will become
 very useful once we start putting together a demo.
\end_layout

\begin_layout Standard
Let's study the code in figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Qt-Creator-session"
plural "false"
caps "false"
noprefix "false"

\end_inset

starting from main():
\end_layout

\begin_layout Itemize
initDemo() is called first thing
\end_layout

\begin_deeper
\begin_layout Itemize
this declares screensize global variables xres=320 and yres=180
\end_layout

\begin_layout Itemize
it allocates memory for a screenBuffer (also global variable)
\end_layout

\begin_layout Itemize
and calls starsInit()
\end_layout

\begin_deeper
\begin_layout Itemize
this is obviously our effect init-code
\end_layout

\begin_layout Itemize
made known via 
\emph on
#include 
\begin_inset Quotes eld
\end_inset

starseffect.h
\begin_inset Quotes erd
\end_inset

 
\emph default
in line 2
\end_layout

\end_deeper
\begin_layout Itemize
starsInit() is not entirely shown in the figure
\end_layout

\begin_deeper
\begin_layout Itemize
it calculates quasi random 3D star-coordinates 
\end_layout

\begin_layout Itemize
and calculates a palette
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
wosInit() is called next
\end_layout

\begin_deeper
\begin_layout Itemize
this sets up the graphics display amongst other things, and might potentially
 disable multi-tasking on the Amiga (depending in wether or not wickedquicklink.s
 / wickedlink.s have been assembled with or without the 
\emph on
KILLER 
\emph default
flag.)
\end_layout

\begin_layout Itemize
wosInit() does not immediately return, but
\end_layout

\begin_deeper
\begin_layout Itemize
hands over control to mainDemo()
\end_layout

\begin_layout Itemize
only returns to main() once the demo is over
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
mainDemo()
\end_layout

\begin_deeper
\begin_layout Itemize
wosSetMode(8, screenBuffer, starsPalette(), 256);
\end_layout

\begin_deeper
\begin_layout Itemize
sets up a low-res 320x180 screenmode (#8)
\end_layout

\begin_layout Itemize
fed from screenBuffer
\end_layout

\begin_layout Itemize
with colours from starsPalette() at normal brigthness (256)
\end_layout

\end_deeper
\begin_layout Itemize
on Amiga
\end_layout

\begin_deeper
\begin_layout Itemize
mainDemo() then loops over drawDemo(), providing time as ticks (1/50 s)
\end_layout

\begin_layout Itemize
until wosCheckExit() returns !=0
\end_layout

\end_deeper
\begin_layout Itemize
on PC (WIN32) 
\end_layout

\begin_deeper
\begin_layout Itemize
mainDemo() immediately returns
\end_layout

\begin_layout Itemize
and drawDemo(time) is called from somewhere else from Qt
\end_layout

\end_deeper
\begin_layout Itemize
(this is why there is this 
\emph on
#ifndef WIN32 [..] #endif
\emph default
 block)
\end_layout

\end_deeper
\begin_layout Itemize
drawDemo() just
\end_layout

\begin_deeper
\begin_layout Itemize
renders the stars effect based on the given time
\end_layout

\begin_layout Itemize
updated the display with wosDisplay(2);
\end_layout

\begin_deeper
\begin_layout Itemize
the 2 denotes a lock to 25 fps maximum
\end_layout

\begin_layout Itemize
which is realistic for low-res chunky to planar effects on AGA/060 config
\end_layout

\begin_layout Itemize
motion will look smoother at a constant framerate rather than a slightly
 faster on
\end_layout

\begin_layout Itemize
you could try (1) for a maximum 50 fps frame-lock or (0) for no lock
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
starsRender()
\end_layout

\begin_deeper
\begin_layout Itemize
clears the screenBuffer
\end_layout

\begin_layout Itemize
calls starsDraw(), with
\end_layout

\begin_deeper
\begin_layout Itemize
time
\end_layout

\begin_layout Itemize
32 as a constant factor for the perspective
\end_layout

\begin_layout Itemize
screenbuffer, xres, yres
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
starsDraw() finally
\end_layout

\begin_deeper
\begin_layout Itemize
iterates over the number of stars (7000)
\end_layout

\begin_layout Itemize
and for each star
\end_layout

\begin_deeper
\begin_layout Itemize
apply z-movement based on time with boolean clipping
\end_layout

\begin_layout Itemize
project x/y based on a floating point perspective factor derived from 1/z
 *variable factor
\end_layout

\begin_layout Itemize
determines a pixel-colour based on z
\end_layout

\begin_layout Itemize
adds that colour to the screenbuffer if the pixel is inside the x/y/z box
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
upon exit, deinitDemo() is called, which
\end_layout

\begin_deeper
\begin_layout Itemize
calls starsRelease() - an empty function/stub
\end_layout

\begin_layout Itemize
frees the tempBuffer that contained the screenBuffer and some safety margin
\end_layout

\end_deeper
\begin_layout Standard
The resulting effect is a classic, albeit simple starfield.
 It doesn't rotate or even just move in different directions.
 All of this could be added, if needs be.
 But we recommend you to go on and just take this as an example of a typical
 project setup.
\end_layout

\begin_layout Subsubsection
Compile for and run on Amiga
\end_layout

\begin_layout Standard
If you now wanted to compile the stars for Amiga, you would:
\end_layout

\begin_layout Itemize
open a console window on PC
\end_layout

\begin_layout Itemize

\emph on
cd
\emph default
 to the
\emph on
 /stars/build
\emph default
 folder
\end_layout

\begin_layout Itemize
run 
\emph on
make
\end_layout

\begin_layout Standard
And then to run it on the Amiga, you would:
\end_layout

\begin_layout Itemize

\emph on
cd
\emph default
 to the 
\emph on
/stars
\emph default
 folder on Amiga
\end_layout

\begin_layout Itemize
run 
\emph on
build/stars
\end_layout

\begin_layout Standard
For this simple project, which doesn't load any external data-files, you
 could actually also run it from the 
\emph on
build
\emph default
 folder.
 But as soon as you want to load data (which we put in
\emph on
 /data
\emph default
 by convention), you would need to make sure you run your executables from
 the right folder.
\end_layout

\begin_layout Subsection
Picture
\end_layout

\begin_layout Standard
This example loads in and displays a picture that has been written in the
 standard GIF file-format.
\end_layout

\begin_layout Subsubsection
Overview
\end_layout

\begin_layout Itemize
Open, configure, build and run 
\emph on
picture.pro
\emph default
 from the 
\emph on
/demo/picture
\emph default
 folder
\end_layout

\begin_layout Itemize
\noindent
You should be presented with a picture in 320x180 resolution and 8-bit colour-de
pth
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename picture.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Picture project (artwork by Helge/Haujobb)
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Discussion
\end_layout

\begin_layout Standard
The effect simply loads a picture in GIF-format which can be created with
 standard tools like Photoshop or Pro Motion.
 This is a lot easier and less time-consuming than always employing a graphics
 converter program.
 
\end_layout

\begin_layout LyX-Code
void pictureEffectInit() { 
\end_layout

\begin_layout LyX-Code
   int w,h;
\end_layout

\begin_layout LyX-Code
   gifLoad("data/helge-haujobb.gif", (void**)&picture, &w,&h, 
\end_layout

\begin_layout LyX-Code
          (unsigned int*)&picturepal); 
\end_layout

\begin_layout LyX-Code
   g_currentPal = picturepal; 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
The control flow of this example is the same as in the previous example
 stars.
 So upon init, the pictureEffectInit() function is called, which calls gifLoad()
 with
\end_layout

\begin_layout Itemize
the filename
\end_layout

\begin_layout Itemize
a pointer (&picture) to where the pointer to the loaded and decoded picture
 should be stored
\end_layout

\begin_deeper
\begin_layout Itemize
note that GIF is an 8-bit format with up to 256 colours
\end_layout

\begin_layout Itemize
picture is thus defined as unsigned char*
\end_layout

\end_deeper
\begin_layout Itemize
pointers to the int variables w & h which will store width and height of
 the decoded image
\end_layout

\begin_layout Itemize
a pointer to an array of 256 unsigned int to store the image palette
\end_layout

\begin_layout Standard
Finally, pictureEffectInit() also copies the pointer to the loaded image
 palette to g_currentPal, which can be accessed from main.c in function drawDemo(
).
 Here, the palette brightness will be calculated with a simple time-based
 function that makes the image fade in and out smoothly on a sine-wave.
 Note that the standard brightness for paletted image is 256.
 In this example it is just going slightly above that for an exaggerated
 effect.
\end_layout

\begin_layout Subsubsection
Changing the palette
\end_layout

\begin_layout Standard
If you run this example on the Amiga (like the stars example), you will
 notice that the background colour around the image is not black and thus
 also fades in and out.
 This is often not the desired effect.
 To fix it, we need to have look at the palette.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename picture-palette.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Sorting-the-picture"

\end_inset

Sorting the picture palette with the Pro Motion NG palette editor
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Tools like Photoshop are very good for all sorts of image manipulations
 and can also be used to save in the GIF-format.
 But it does not sort the colours in the way we would prefer it, i.e.
 keep colour 0 dark.
 Photoshops' palette editor is also below standard.
 Thus we will use a different PC-based tool to fiddle with the palette:
 
\emph on
Pro Motion N
\emph default
G from 
\begin_inset CommandInset href
LatexCommand href
name "https://www.cosmigo.com/"
target "https://www.cosmigo.com/"
literal "false"

\end_inset

.
 The available free version is enough for this excercise.
 So download and install it, then:
\end_layout

\begin_layout Itemize
Open the image 
\begin_inset Quotes eld
\end_inset

data/helge-haujobb.gif
\begin_inset Quotes erd
\end_inset

 by selecting menu 
\emph on
File -> Load Image ...
\end_layout

\begin_layout Itemize
You should see the image and the palette-editor (as in 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Sorting-the-picture"
plural "false"
caps "false"
noprefix "false"

\end_inset

, left).
\end_layout

\begin_deeper
\begin_layout Itemize
If not, press F12 to open it.
\end_layout

\end_deeper
\begin_layout Itemize
Now press the 
\emph on
Functions
\emph default
 button in the palette editor and select 
\emph on
Sort -> Brightness
\emph default
.
 
\end_layout

\begin_deeper
\begin_layout Itemize
Ok, so the colors are sorted now, but from brightest to darkest.
 Your palette should look like in 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Sorting-the-picture"
plural "false"
caps "false"
noprefix "false"

\end_inset

, middle.
\end_layout

\begin_layout Itemize
But the image still looks odd.
\end_layout

\end_deeper
\begin_layout Itemize
Press the 
\emph on
Remap
\emph default
 button in the palette editor, or select menu 
\emph on
Colors -> Resample (!) Color
\end_layout

\begin_layout Itemize
To have then have the palette sorted from darkest to brightest we have to
 use flip function now 
\emph on
(Functions -> Flip
\emph default
).
\end_layout

\begin_deeper
\begin_layout Itemize
Your palette should look like in 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Sorting-the-picture"
plural "false"
caps "false"
noprefix "false"

\end_inset

, right, as desired.
\end_layout

\end_deeper
\begin_layout Itemize
Press 
\emph on
Remap
\emph default
, again.
\end_layout

\begin_layout Standard
You can save the image, reload the Amiga executable without compiling it
 again, and the border should stay dark.
\end_layout

\begin_layout Subsection
Movetable
\end_layout

\begin_layout Standard
This example shows a typical movetable effect in 320x180 pixel resolution
 and 8-bit colour-depth.
 
\end_layout

\begin_layout Subsubsection
Overview
\end_layout

\begin_layout Itemize
Open, configure, build and run 
\emph on
movetable.pro
\emph default
 from the 
\emph on
/demo/movetable
\emph default
 folder
\end_layout

\begin_layout Itemize
\noindent
You should be presented with an effect in 320x180 resolution and 8-bit colour-de
pth
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename movetable.png

\end_inset


\begin_inset Graphics
	filename texture.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Movetable effect and underlying texture (texture by JCS/Haujobb)
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Discussion
\end_layout

\begin_layout Standard
The effect uses a texture of size 256x256 which is loaded from a GIF file,
 like in the previous example.
 Furthermore, it uses a movetable which is generated using trigonometric
 functions and finally uses those two components to build the screen by
 obtaining per pixel texture coordinates from the movetable, moved by a
 smoothly animated x- and y-offset on a sine-wave.
 The movetable is exactly twice the size of the screen, so 640x360 in this
 case, and represents a tunnel shape.
 Other shapes are possible.
 Let's look at some details.
\end_layout

\begin_layout LyX-Code
void movetableInit() { 
\end_layout

\begin_layout LyX-Code
    int tabsize; int w,h;
\end_layout

\begin_layout LyX-Code
    gifLoad("data/texture.gif", (void**)&texture, &w,&h,
\end_layout

\begin_layout LyX-Code
        (unsigned int*)&texturepal);
\end_layout

\begin_layout LyX-Code
// provide 256x256x8 tga-file and test this
\end_layout

\begin_layout LyX-Code
    //tgaLoad8("data/texture.tga", (void**)&texture, &w,&h,
\end_layout

\begin_layout LyX-Code
        (unsigned int*)&texturepal); 
\end_layout

\begin_layout LyX-Code
    g_currentPal = texturepal;
\end_layout

\begin_layout LyX-Code
    
\end_layout

\begin_layout LyX-Code
// allocate memory 
\end_layout

\begin_layout LyX-Code
    tabsize= tabx*taby; 
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
// table size 
\end_layout

\begin_layout LyX-Code
    xtab= (char*)malloc(tabsize); 
\end_layout

\begin_layout LyX-Code
    ytab= (char*)malloc(tabsize);
\end_layout

\begin_layout LyX-Code
    
\end_layout

\begin_layout LyX-Code
// build tables 
\end_layout

\begin_layout LyX-Code
    //buildSphere(xtab, ytab);
\end_layout

\begin_layout LyX-Code
    //buildWater(xtab, ytab);
\end_layout

\begin_layout LyX-Code
    buildTunnel(xtab, ytab); 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
If you look at function moveTableInit() from movetableeffect.c you will see
 how the texture is loaded and the function to build the table is called.
\end_layout

\begin_layout Standard
Just after the gifLoad() function is a tgaLoad8() function with the same
 signature, which loads the Targa Image File format TGA.
 Targa is supported by Photoshop and other tools.
 It is usually uncompressed and loads faster than GIF.
 The bigger file-size of TGA is compressed away when you bundle your demo
 in a compressed archive.
 Furthermore, Targa files also support higher colour depths; a feature that
 will come in handy when you work with true colour screenmodes.
 As an exercise, you could:
\end_layout

\begin_layout Itemize
provide a file called texture.tga in 256x256 pixel size and 8-bit colour
 depth
\end_layout

\begin_layout Itemize
comment out the gifLoad() line and comment in the tgaLoad8() line
\end_layout

\begin_layout Itemize
the effect should work as before
\end_layout

\begin_layout Standard
moveTableInit() then allocates some memory and calls \SpecialChar allowbreak
buildTunnel(), one
 of three supplied build-functions, to fill that memory with movetable data.
\end_layout

\begin_layout Itemize
Try out the other two!
\end_layout

\begin_layout Section
Demo Example
\end_layout

\begin_layout Standard
This chapter pulls all the strings together and provides a complete example
 demo that comprises of the previously discussed component with some added
 streaming music.
 The effects' parameters are controlled via the excellent Rocket sync-tracker.
 Although this approach to demo-syncing is quite common in the PC-scene
 for many years, it is still fairly unknown in the Amiga-scene and only
 used by very few demo-makers, like e.g.
 Loonies.
 In Haujobb, we have started using Rocket when developing the 
\begin_inset CommandInset href
LatexCommand href
name "Beam Riders"
target "https://www.pouet.net/prod.php?which=71976"
literal "false"

\end_inset

demo.
 We have previously spoken about our demo-making process in our Evoke 2018
 talk 
\begin_inset CommandInset href
LatexCommand href
name "Modern Amiga Demo Cross-Development (YouTube)"
target "https://www.youtube.com/watch?v=s1lVS4tW33g"
literal "false"

\end_inset

.
 With the release of our Amiga demo framework, we are now publicly sharing
 a complete and documented example of how to sync your Amiga demos with
 Rocket.
 This is how we did it.
 And now you can do it, too!
\end_layout

\begin_layout Subsection
Hello Demo
\end_layout

\begin_layout Subsubsection
Overview
\end_layout

\begin_layout Itemize
Open, configure, build and run 
\emph on
hellodemo.pro
\emph default
 from the 
\emph on
/demo/hellodemo
\emph default
 folder
\end_layout

\begin_layout Itemize
\noindent
The demo will refuse to start with the error message: 
\begin_inset Quotes eld
\end_inset

Could not connect to rocket editor!
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Itemize
This is because the source-code of hellodemo is configured
\end_layout

\begin_deeper
\begin_layout Itemize
to require the Rocket editor on the PC
\end_layout

\begin_layout Itemize
and to play the demo from the stored parameters on the Amiga.
\end_layout

\end_deeper
\begin_layout Subsubsection
SYNC_PLAYER
\end_layout

\begin_layout Standard
If you wanted to quickly check the example demo on the PC, you thus need
 to configure the source-code to not require the Rocket editor on the PC.
 This is done with the 
\emph on
SYNC_PLAYER
\emph default
 define in line 1 of main.c.
 If it is defined, the demo will load the 
\emph on
*.rt
\emph default
 files from the /data directory and then play the demo with those parameters.
 So uncomment that define and run hellodemo again.
 It should start and show several effects timed to some music by Muffler.
\end_layout

\begin_layout Standard
When you are done with that, comment that define-line out again, as you
 usually would want to work in edit mode on PC.
\end_layout

\begin_layout Standard
Note: the Amiga build gets the SYNC_PLAYER define injected via the makefile
 (-DSYNC_PLAYER in CFLAGS, currently in line 40, c.f.
 section 2.1 in 
\begin_inset CommandInset href
LatexCommand href
name "VBCC docs"
target "http://www.ibaug.de/vbcc/doc/vbcc.pdf"
literal "false"

\end_inset

).
\end_layout

\begin_layout Subsubsection
Good Practice Track Names
\end_layout

\begin_layout Standard
Rocket track names are your interface to your demo.
 For a typical demo, you will quickly have dozens of track names, so it
 is a Good Idea TM to name them properly.
 They also need to operate within certain limits:
\end_layout

\begin_layout Itemize
keep names short, meaningful and lowercase
\end_layout

\begin_layout Itemize
all Rocket tracks are Floats by default
\end_layout

\begin_deeper
\begin_layout Itemize
but you can cast them e.g.
 to Int within your code
\end_layout

\end_deeper
\begin_layout Itemize
Furthermore they are also saved to disk with filenames comprising of a certain
 scheme (we chose: sync_*.rt, where * is effectname_variablename, e.g.
 sync_movetable(2)_time.rt) that will have to fit within the Amiga Fast File
 System filename-length limit of 30 chars.
\end_layout

\begin_layout Standard
From our own experience we can propose the following:
\end_layout

\begin_layout Itemize
part : should be used as an Int to keep track of the currently visible part
\end_layout

\begin_layout Itemize
brightness : Int for the current palette brightness (if applicable), 0 means
 black, 256 is normal, >256 brighter
\end_layout

\begin_layout Itemize
effects should expose their name plus their part number in brackets, e.g.
 movetable(2), as some kind of namespace
\end_layout

\begin_deeper
\begin_layout Itemize
effect variables are are appended to this namespace-name with a colon (
\begin_inset Quotes eld
\end_inset

:
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Itemize
see the code from getSyncTracks() from main.c as an example
\end_layout

\end_deeper
\begin_layout LyX-Code
void getSyncTracks() { 
\end_layout

\begin_deeper
\begin_layout LyX-Code
// rocket get tracks 
\end_layout

\begin_layout LyX-Code
// general 
\end_layout

\begin_layout LyX-Code
rt_part = sync_get_track(rocket, "part"); 
\end_layout

\begin_layout LyX-Code
rt_brightness = sync_get_track(rocket, "brightness");
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
// pictures 
\end_layout

\begin_layout LyX-Code
rt_picture_id = sync_get_track(rocket, "picture(0):id");
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
// stars 
\end_layout

\begin_layout LyX-Code
rt_star_time = sync_get_track(rocket, "stars(1):time"); 
\end_layout

\begin_layout LyX-Code
rt_star_pers = sync_get_track(rocket, "stars(1):perspective");
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
// movetable 
\end_layout

\begin_layout LyX-Code
rt_move_time = sync_get_track(rocket, "movetable(2):time"); 
\end_layout

\begin_layout LyX-Code
rt_move_xtab = sync_get_track(rocket, "movetable(2):xtab"); 
\end_layout

\begin_layout LyX-Code
rt_move_ytab = sync_get_track(rocket, "movetable(2):ytab");
\end_layout

\end_deeper
\begin_layout LyX-Code
} 
\end_layout

\begin_layout Standard
Adhering to such a scheme will make your life easier when wiring up the
 internals in your code and when timing your demo.
 So better stick to it.
\end_layout

\begin_layout Subsection
Rocket Editor
\end_layout

\begin_layout Standard

\emph on
Rocket is is an intuitive new way of...
 bah, whatever.
 It's a sync-tracker, a tool for synchronizing music and visuals in demoscene
 productions.
 It consists of a GUI editor (using Qt), and an ANSI C library that can
 either communicate with the editor over a network socket, or play back
 an exported data-set.

\emph default
 â€“ from 
\begin_inset CommandInset href
LatexCommand href
name "Rocket GitHub page"
target "https://github.com/rocket/rocket"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
To get started with using the Rocket editor, download the latest official
 binaries from the GitHub 
\begin_inset CommandInset href
LatexCommand href
name "Rocket releases"
target "https://github.com/rocket/rocket/releases"
literal "false"

\end_inset

.
 The archives come readily bundled with the required libraries, so just
 unpacking and starting
\emph on
 editor.exe
\emph default
 should work.
 Since its inception, several ports of the Rocket editor have appeared.
 All of them are listed on the 
\begin_inset CommandInset href
LatexCommand href
name "Rocket GitHub page"
target "https://github.com/rocket/rocket"
literal "false"

\end_inset

.
 We personally only worked with the original editor, but also quickly tested
 the alternative 
\begin_inset CommandInset href
LatexCommand href
name "OpenGL editor"
target "https://github.com/emoon/rocket"
literal "false"

\end_inset

 and can confirm that it works.
\end_layout

\begin_layout Standard
On Windows, the Windows firewall would usually come up when starting your
 chosen editor for the first time.
 Just allow it to pass, as the editor will need to communicate with the
 demo via network.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename hellodemo.png
	width 100col%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Rocket-editor-(left)"

\end_inset

Rocket editor (left) and hellodemo (right)
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Once you started the editor, you can recompile (without SYNC_PLAYER defined)
 and run the hellodemo project.
 You should immediately see some magic happen in the editor.
 As the demo and the editor already communicated about the available sync
 tracks, the editor should show them neatly organised in tabs, here: 
\emph on
default
\emph default
, 
\emph on
picture(0)
\emph default
, 
\emph on
stars(1)
\emph default
, 
\emph on
movetable(2)
\emph default
.
 The sync tracks still have no keyframes and interpolation methods assigned,
 yet.
 This is the typical state of how you would start with a clean slate once
 you wired up your Rocket variables in your code.
\end_layout

\begin_layout Standard
To get started with our example, load the provided file
\emph on
 hellodemo.rocket
\emph default
 from /data/hellodemo into your editor.
 This should populate the sync-tracks with data (see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Rocket-editor-(left)"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 You can now start and stop playing the demo by pressing <SPACE> in the
 editor.
\end_layout

\begin_layout Subsubsection
Using the Editor
\end_layout

\begin_layout Standard
Note: This section is copied from the official 
\begin_inset CommandInset href
LatexCommand href
name "Rocket documentation"
target "https://github.com/rocket/rocket"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
The Rocket editor is laid out like a music-tracker; tracks (or columns)
 and rows.
 Each track represents a separate "variable" in the demo, over the entire
 time-domain of the demo.
 Each row represents a specific point in time, and consists of a set of
 key frames.
 The key frames are interpolated over time according to their interpolation
 modes.
\end_layout

\begin_layout Paragraph
Interpolation modes
\end_layout

\begin_layout Standard
Each key frame has an interpolation mode associated with it, and that interpolat
ion mode is valid until the next key frame is reached.
 The different interpolation modes are the following:
\end_layout

\begin_layout Standard

\emph on
Step 
\emph default
: This is the simplest mode, and always returns the key's value.
\end_layout

\begin_layout Standard

\emph on
Linear
\emph default
 : This does a linear interpolation between the current and the next key's
 values.
\end_layout

\begin_layout Standard

\emph on
Smooth
\emph default
 : This interpolates in a smooth fashion, the exact function is what is
 usually called "smoothstep".
 Do not confuse this mode with splines; this only interpolates smoothly
 between two different values, it does not try to calculate tangents or
 any such things.
\end_layout

\begin_layout Standard

\emph on
Ramp
\emph default
 : This is similar to "Linear", but additionally applies an exponentiation
 of the interpolation factor.
\end_layout

\begin_layout Paragraph
Keyboard shortcuts
\end_layout

\begin_layout Standard
Some of the Rocket editor's features are available through the menu and
 some keyboard shortcut.
 Here's a list of the supported keyboard shortcuts:
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="21" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
Shortcuts
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
Action
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Up/Down/Left/Right
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Move cursor
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
PgUp/PgDn
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Move cursor 16 rows up/down
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Home/End
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Move cursor to begining/end
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+Left/Right
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Move tracks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Enter
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Enter key frame values
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Del
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Delete key frame
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
i
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Enumerate interpolation mode
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
k
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Toggle row-bookmark
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alt+PgUp/PgDn
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Go to prev/next row-bookmark
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Space
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pause/Resume demo
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Shift+Up/Down/Left/Right
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Select
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+C
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Copy
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+V
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Paste
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+Z
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Undo
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Shift+Ctrl+Z
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Redo
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl-B
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Bias key frames
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Shift+Ctrl+Up/Down
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Quick-bias by +/- 0.1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+Up/Down
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Quick-bias by +/- 1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ctrl+PgUp/PgDn
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Quick-bias by +/- 10
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Shift+Ctrl+PgUp/PgDn
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Quick-bias by +/- 100
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Rocket editor shortcuts
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Wiring up your variables to Rocket
\end_layout

\begin_layout Standard
Wiring up your code's internal variables to Rocket so that they can be modified
 over the network connection with the Rocket editor is at the heart of working
 with Rocket from a coder's perspective.
 It is a straight forward process that you will quickly embrace once you
 know what needs to be done.
\end_layout

\begin_layout Standard
All of this is usually happening in your demo's main.c - the effects do not
 know about Rocket at all.
 For the purpose of this write-up, we are just handling the case of the
 stars effect.
 All other effects are handled in the same way and you can follow everything
 in full detail in hellodemo's main.c.
\end_layout

\begin_layout Subsubsection
Declarations
\end_layout

\begin_layout Standard
Include Rocket definitions from:
\end_layout

\begin_layout LyX-Code
#include "../shared/rocket/lib/sync.h"
\end_layout

\begin_layout Standard
For working with Rocket, you always need a 
\emph on
sync_device
\emph default
:
\end_layout

\begin_layout LyX-Code
struct sync_device *rocket; 
\end_layout

\begin_layout Standard
You would then define multiple 
\emph on
sync_tracks
\emph default
, one for every variable that you want to animate:
\end_layout

\begin_layout LyX-Code
const struct sync_track *rt_star_time;
\end_layout

\begin_layout LyX-Code
const struct sync_track *rt_star_pers;
\end_layout

\begin_layout Standard
Tracknames should start with 
\begin_inset Quotes eld
\end_inset

rt_
\begin_inset Quotes erd
\end_inset

.
 It is suggested that you name them according to their namespace and variable
 names, e.g.
 rt_part or rt_star_time.
\end_layout

\begin_layout Subsubsection
sync_get_track()
\end_layout

\begin_layout Standard
Your internal sync_tracks are made known to the Rocket editor via the 
\emph on
sync_get_track
\emph default
 function.
 Its invocation is also the place to provide the names that appear in the
 editor and on disk for the saved tracks.
 In hellodemo's main.c this is all done in getSyncTracks():
\end_layout

\begin_layout LyX-Code
void getSyncTracks() {
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
// stars
\end_layout

\begin_layout LyX-Code
rt_star_time = sync_get_track(rocket, "stars(1):time");
\end_layout

\begin_layout LyX-Code
rt_star_pers = sync_get_track(rocket, "stars(1):perspective");
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
Depending on the definition of SYNC_PLAYER, sync_get_tracks will either
 connect to the editor, or try to load the tracks from disk.
\end_layout

\begin_layout Subsubsection
sync_get_val()
\end_layout

\begin_layout Standard
Getting variables out of Rocket is done via the 
\emph on
sync_get_val
\emph default
 function.
 It takes the desired trackname and row-position as input and returns a
 Float.
 The calculation of 
\emph on
row
\emph default
 is based on the play-time of the music.
 Implementation details can be found in drawDemo() and also in updateDemo().
\end_layout

\begin_layout Standard
The code snippet below shows how we get the variables for the stars effect:
\end_layout

\begin_layout LyX-Code
void drawDemo(int time) { 
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
int ri_star_time; 
\end_layout

\begin_layout LyX-Code
float rf_star_pers;
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
// stars
\end_layout

\begin_layout LyX-Code
ri_star_time = (int) sync_get_val(rt_star_time, row);
\end_layout

\begin_layout LyX-Code
rf_star_pers = (float) sync_get_val(rt_star_pers, row);
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
As per our convention, variables from Rocket that hold:
\end_layout

\begin_layout Itemize

\emph on
Float
\emph default
 values (the default) should be preceeded with 
\emph on

\begin_inset Quotes eld
\end_inset

rf_
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Itemize

\emph on
Int
\emph default
 values (requiring an explicit cast) should be preceeded with 
\emph on

\begin_inset Quotes eld
\end_inset

ri_
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Subsubsection
Passing variables to an effect
\end_layout

\begin_layout Standard
Once we have the time-based values for our variables from Rocket, we can
 feed them to our effects.
 As written above, the effects to not know of Rocket.
 They just need to get their parameters when calling their render-function.
 All effects take the variable 
\emph on
time
\emph default
 as their first and most imporant parameter.
 They are required to render a frame according to 
\emph on
time
\emph default
.
\end_layout

\begin_layout Standard
The stars effect additionally takes a perpective factor as a parameter.
\end_layout

\begin_layout LyX-Code
void starsEffectRender(int time, float persfak);
\end_layout

\begin_layout Subsection
Common Effect Functions
\end_layout

\begin_layout Standard
As previously implicitly covered 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:StarsDiscussion"
plural "false"
caps "false"
noprefix "false"

\end_inset

, effects are expected to have typical functions when working our way.
\end_layout

\begin_layout Standard
More explicitly, the minimum required functions when coding single effects
 are:
\end_layout

\begin_layout LyX-Code
void effectInit();
\end_layout

\begin_layout LyX-Code
void effectRender(int time);
\end_layout

\begin_layout LyX-Code
void effectRelease();
\end_layout

\begin_layout LyX-Code
unsigned int* effectPalette();
\end_layout

\begin_layout Standard
Init, Render and Release should be clear.
 The Palette function is required, as the current palette will be used outside
 the scope of the effect, e.g.
 to support setting the brightness.
\end_layout

\begin_layout Standard
To avoid name-clashes, it is good practice to preceed those names with the
 actual effect name, e.g.
 starsEffectInit().
\end_layout

\begin_layout Standard
When putting the effects together as a demo, you need one additonal function:
\end_layout

\begin_layout LyX-Code
void effectOn(int startTime);
\end_layout

\begin_layout Standard
This is a very short function that basically sets the screenmode, palette
 and dimensions (xres/yres) everytime an effect is called for the first
 time.
 This is required because you will want to have different effects that might
 run in different screen modes.
 Here is how the starsEffectOn() function looks like:
\end_layout

\begin_layout LyX-Code
void starsEffectOn(int startTime) {
\end_layout

\begin_deeper
\begin_layout LyX-Code
starsEffect_startTime=startTime;
\end_layout

\begin_layout LyX-Code
xres=320; 
\end_layout

\begin_layout LyX-Code
yres=180;
\end_layout

\begin_layout LyX-Code
wosSetMode(8, screenBuffer, starsPalette(), 0);
\end_layout

\begin_layout LyX-Code
g_currentPal = starsPalette();
\end_layout

\end_deeper
\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
The 
\emph on
startTime
\emph default
 is not always used, but always required by convention.
 
\emph on
xres
\emph default
 and 
\emph on
yres
\emph default
 in this example are for a typical 16:9 low-res screen.
 
\emph on
wosSetMode
\emph default
 sets up the display for that mode (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:List-of-Screenmodes"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for a list of available modes) to work from that frame-buffer 
\emph on
screenBuffer
\emph default
 and with the palette pointer obtained from 
\emph on
starsPalette()
\emph default
.
 The initial brightness is set to 0 (black).
 Finally, the palette pointer is stored in the global variable 
\emph on
g_currentPal
\emph default
.
\end_layout

\begin_layout Subsection
Common Demo Functions
\end_layout

\begin_layout Standard
When putting your effects together as a demo, you would naturally call their
 
\emph on
Init
\emph default
 and 
\emph on
Release
\emph default
 functions from the respective functions in the demo's main.c (here: 
\emph on
initDemo
\emph default
 and 
\emph on
deinitDemo
\emph default
).
 Actually, in hellodemo, the init-functions are all grouped in another function
 called 
\emph on
reloadDemo
\emph default
.
 This will become useful later when starting to use the file-watcher and
 auto-reload functionality.
\end_layout

\begin_layout Subsubsection
drawDemo()
\end_layout

\begin_layout Standard
Then, when it is time to draw a frame, the demo needs to figure out which
 effect (part) needs to be called, and if it had already been shown in the
 previous frame.
 If not, the part has to be enabled.
 This is done like this:
\end_layout

\begin_layout LyX-Code
int prevPart=-1;
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
void drawDemo(int time) {
\end_layout

\begin_deeper
\begin_layout LyX-Code
int curPart;
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
curPart = (int) sync_get_val(rt_part, row);
\end_layout

\begin_layout LyX-Code
// init part
\end_layout

\begin_layout LyX-Code
if ( (prevPart != curPart) | curPart==0) {
\end_layout

\begin_deeper
\begin_layout LyX-Code
switch (curPart) {
\end_layout

\begin_deeper
\begin_layout LyX-Code
case 0:
\end_layout

\begin_deeper
\begin_layout LyX-Code
pictureEffectOn(time); break;
\end_layout

\end_deeper
\begin_layout LyX-Code
case 1:
\end_layout

\begin_layout LyX-Code
  starsEffectOn(time); break;
\end_layout

\begin_layout LyX-Code
case 2:
\end_layout

\begin_layout LyX-Code
  movetableEffectOn(time); break;
\end_layout

\end_deeper
\end_deeper
\begin_layout LyX-Code
     default: break;
\end_layout

\begin_layout LyX-Code
   };
\end_layout

\begin_layout LyX-Code
} 
\end_layout

\end_deeper
\begin_layout Standard
When it is verified that the part is enabled, it can be drawn like this:
\end_layout

\begin_layout LyX-Code
[..]
\end_layout

\begin_layout LyX-Code
// draw part
\end_layout

\begin_layout LyX-Code
switch (curPart) {
\end_layout

\begin_deeper
\begin_layout LyX-Code
case 0:
\end_layout

\begin_layout LyX-Code
   pictureEffectRender(ri_picture_id); break;
\end_layout

\begin_layout LyX-Code
case 1:
\end_layout

\begin_layout LyX-Code
   starsEffectRender(ri_star_time, rf_star_pers); break;
\end_layout

\begin_layout LyX-Code
case 2:
\end_layout

\begin_layout LyX-Code
   movetableEffectRender(ri_move_time, ri_move_xtab, 
\backslash

\end_layout

\begin_layout LyX-Code
                         ri_move_ytab); break;
\end_layout

\end_deeper
\begin_layout LyX-Code
   default: break;
\end_layout

\begin_layout LyX-Code
   };
\end_layout

\begin_layout Standard
Finally, at the end of the draw function, the prevPart variable it prepared
 for the next frame, and the current frame is displayed.
 
\end_layout

\begin_layout LyX-Code
prevPart = curPart;
\end_layout

\begin_layout LyX-Code
wosDisplay(2); 
\end_layout

\begin_layout Standard

\emph on
wosDisplay
\emph default
 triggers the chunky to planar conversion, i.e.
 the conversion of the byte-chunked 
\emph on
screenBuffer
\emph default
 (of 8 bit colour depth, as set previously with wosSetMode) into 8 seperate
 bitplanes to be displayed by the Amiga AGA chipset.
 Due to the slow speed of the chip memory, the Amiga will spend almost an
 entire frame for this conversion in a typical low-res resolution.
 It is generally unrealistic to expect to be able to draw 50 frames per
 second (FPS).
 Depending on the effect complexity, the target hardware, and the frame's
 content, you would often be able to reach a framerate in the range of 25
 to 40 frames per second.
 But a stable motion at a fixed framerate looks smoother than one with varying
 framerate.
 Therefore, wosDisplay takes a frame-lock parameter:
\end_layout

\begin_layout Itemize
0 : no frame-lock, i.e.
 run as fast as possible (possible faster than 50 FPS in very low resolutions)
\end_layout

\begin_layout Itemize
1 : frame-lock to every frame, i.e.
 50 FPS max
\end_layout

\begin_layout Itemize
2 : frame-lock to every other frame, i.e.
 25 FPS max
\end_layout

\begin_layout Standard
While 50 FPS can be achieved with some 160x90 screenmodes, you would generally
 want to aim for 25 FPS with low-res 320x180 screenmodes.
\end_layout

\begin_layout Subsubsection
updateDemo()
\end_layout

\begin_layout Standard
While most screenmodes will not update in every frame, there is a possibilty
 to run certain parts of the code at 50 FPS intervals by putting it in the
 provided
\emph on
 updateDemo
\emph default
 function.
 This is triggered by the vertical blank interrupt (VBI) from 
\emph on
assemly-bridge.s
\emph default
 and can be used for making quick changes, e.g.
 to the colour palette when fading.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Annex
\end_layout

\begin_layout Section
Credits
\end_layout

\begin_layout Subsection
Framework
\end_layout

\begin_layout Standard
The Haujobb Amiga Framework has been developed by Hellfire and Noname.
\end_layout

\begin_layout Itemize
low-level hardware API 
\emph on
WickedOS
\emph default
 by Noname
\end_layout

\begin_layout Itemize
high-level PC API counterpart 
\emph on
WOS Qt
\emph default
 by Hellfire
\end_layout

\begin_layout Itemize
standard code in 
\emph on
/shared
\emph default
 by Hellfire
\end_layout

\begin_layout Itemize
examples by Noname and Hellfire
\end_layout

\begin_layout Itemize
documentation by Noname
\end_layout

\begin_layout Subsection
Third party code
\end_layout

\begin_layout Standard
Standing on the shoulders of giants.
 With little modifications here and there.
\end_layout

\begin_layout Itemize
system-friendly hardware startup by Piru
\end_layout

\begin_layout Itemize
system-friendly interrupt example by Comrade J
\end_layout

\begin_layout Itemize
Kickstart v39 sprites fix by Comrade J
\end_layout

\begin_layout Itemize
Speedychip by Piru
\end_layout

\begin_layout Itemize
C2P routines by Kalms
\end_layout

\begin_deeper
\begin_layout Itemize
partially modified with inline-saturation code based on an idea from Blueberry
 by Hellfire and Noname
\end_layout

\end_deeper
\begin_layout Itemize
Further WickedOS components (currently not exposed through API)
\end_layout

\begin_deeper
\begin_layout Itemize
Tracker Packer 3 by Crazy Crack
\end_layout

\begin_layout Itemize
The Player 6.1 by Guru
\end_layout

\begin_layout Itemize
old AHX/THX by Dexter
\end_layout

\begin_layout Itemize
AHX by Dexter
\end_layout

\begin_layout Itemize
Profiler by Bartman
\end_layout

\begin_layout Itemize
CRM decruncher by Thomas Schwarz
\end_layout

\end_deeper
\begin_layout Itemize
ADPCM player in Hello Demo by Kalms (Amiga) and Ian Luck (PC)
\end_layout

\begin_layout Itemize
Rocket sync-tracker and library by Kusma et al.
\end_layout

\begin_layout Subsection
Artwork
\end_layout

\begin_layout Standard
How would life be without artists? The following pieces have been bundled
 with the release of our framework:
\end_layout

\begin_layout Itemize
picture 
\emph on
Haujobb Forever
\emph default
 by Helge
\end_layout

\begin_layout Itemize
picture 
\emph on
Androids Dream
\emph default
 by Acryl
\end_layout

\begin_layout Itemize
movetable texture by JCS
\end_layout

\begin_layout Itemize
music in Hello Demo by Muffler
\end_layout

\begin_layout Section
Trouble-Shooting
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Missing-Standard-Headers"

\end_inset

Missing Standard Headers
\end_layout

\begin_layout Standard
With Visual Studio Community 2017 we have witnessed missing standard headers,
 resulting in compilation problems even for the simplest programs such as
 the hello world 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Hello-World"
plural "false"
caps "false"
noprefix "false"

\end_inset

.Unbelievable as it sounds, this behavior is also documented on 
\begin_inset CommandInset href
LatexCommand href
name "Stack Overflow"
target "https://stackoverflow.com/questions/42777424/visual-studio-2017-errors-on-standard-headers"
literal "false"

\end_inset

, along with the solution in answer #1.
 
\end_layout

\begin_layout Standard
To solve this problem, you need to rerun the Visual Studio Installer and
 select 
\emph on
Windows Universal CRT SDK
\emph default
 under 
\emph on
Individual Components -> Compiler, Buildtools and Runtimes.

\emph default
 Then restart you IDE, and rebuild your project.
\end_layout

\begin_layout Section
WickedOS
\begin_inset CommandInset label
LatexCommand label
name "sec:WickedOS"

\end_inset


\end_layout

\begin_layout Standard
This is a collection of notes about the WickedOS-layer of our Amiga Framework.
 Normally, you should not need to study this, but you are very welcome to.
\end_layout

\begin_layout Subsection
Built-In Test
\end_layout

\begin_layout Standard
If you are feeling nostalgic or curious, you can assembly and run a built-in
 example of WickedOS in ASM-One or Devpac on the Amiga! The visual outcome
 will be the same as that described in section 
\begin_inset CommandInset ref
LatexCommand vref
reference "Built-In-Example-With-vasm-and-vlink"
plural "false"
caps "false"
noprefix "false"

\end_inset

.Of course, it doesn't matter if you are using real or emulated hardware
 for this.
\end_layout

\begin_layout Subsubsection
With ASM-One
\end_layout

\begin_layout Standard
If you coded on Amiga before, chances are that ASM-One is already installed
 and that you know how to use it.
 The minimum supported version is 1.29.
 If you do not have at least this one, just either:
\end_layout

\begin_layout Itemize
download ASM-One from 
\begin_inset CommandInset href
LatexCommand href
target "http://aminet.net/package/dev/asm/ASM-One"
literal "false"

\end_inset

,
\end_layout

\begin_layout Itemize
or get ASM-Pro from 
\begin_inset CommandInset href
LatexCommand href
target "http://aminet.net/package/dev/asm/AsmPro1.18src"
literal "false"

\end_inset

, which is an improved and open-sourced version
\end_layout

\begin_layout Itemize
or grab my copy of 
\begin_inset CommandInset href
LatexCommand href
name "ASM-One v1.29"
target "http://www.dig-id.de/amiga/asmone129.lha"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
Set the WOS: Assign before you start ASM-One.
\end_layout

\begin_layout Enumerate
assign 
\begin_inset Quotes eld
\end_inset

WOS:
\begin_inset Quotes erd
\end_inset

 to where you unpacked WickedOS
\end_layout

\begin_layout Enumerate
list WOS:wos_v#? (should list the main file, currently v1.62)
\end_layout

\begin_layout Enumerate
Consider putting the assign from line 1 into s:user-startup (optional)
\end_layout

\begin_layout Standard
Then test WickedOS' built-in example AGA-screen from within ASM-One.
\end_layout

\begin_layout Enumerate
Start ASM-One from a Shell (This is important, as starting it from an icon
 will cause you a lot of trouble, as previously discussed on 
\begin_inset CommandInset href
LatexCommand href
name "Amiga Demoscene Archive"
target "http://ada.untergrund.net/?p=boardthread&id=144&page=1"
literal "false"

\end_inset

.) 
\end_layout

\begin_layout Enumerate
Give it some public memory
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
ALLOCATE Fast/Chip/Publ/Abs>p
\end_layout

\begin_layout Enumerate
WORKSPACE (Max.
 XXXXX) KB>1000
\end_layout

\begin_layout Enumerate
Note: ASM-One from Aminet (v1.48) seems to expect an assign 
\begin_inset Quotes eld
\end_inset

Sources:
\begin_inset Quotes erd
\end_inset

 at startup.
 If you don't have it, either:
\end_layout

\begin_deeper
\begin_layout Enumerate
assign 
\begin_inset Quotes eld
\end_inset

Sources:
\begin_inset Quotes erd
\end_inset

 to somewhere useful, or just to 
\begin_inset Quotes eld
\end_inset

Ram:
\begin_inset Quotes erd
\end_inset

 for testing
\end_layout

\begin_layout Enumerate
or in Asm-One go to Preferences->Environment and change 
\begin_inset Quotes eld
\end_inset

Default Dir:
\begin_inset Quotes erd
\end_inset

 textbox value to an existing directory or empty it
\end_layout

\begin_layout Enumerate
or restart Asm-One with 
\begin_inset Quotes eld
\end_inset

!
\begin_inset Quotes erd
\end_inset

 to get the memory prompts again.
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate
Menu->Assembler->Preferences->Assembler
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
CPU 68020
\end_layout

\begin_layout Enumerate
Check 
\begin_inset Quotes eld
\end_inset

FPU Present
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Enumerate
Uncheck 
\begin_inset Quotes eld
\end_inset

UCase = LCase
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Enumerate
Uncheck 
\begin_inset Quotes eld
\end_inset

; Comment
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Enumerate
Press 
\begin_inset Quotes eld
\end_inset

Save
\begin_inset Quotes erd
\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Type 
\begin_inset Quotes eld
\end_inset

v wos:
\begin_inset Quotes erd
\end_inset

 (to set the working dir)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
v (to list the dir, just to confirm and refresh your memory)
\end_layout

\end_deeper
\begin_layout Enumerate
Type 
\begin_inset Quotes eld
\end_inset

r
\begin_inset Quotes erd
\end_inset

 (read) and select the latest version of wos:wos_v#?.s
\end_layout

\begin_layout Enumerate
Press <ESC> to get into edit-mode
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Remove the 
\begin_inset Quotes eld
\end_inset

;
\begin_inset Quotes erd
\end_inset

 before WTEST in line 3
\end_layout

\begin_layout Enumerate
Press <ESC> again to go back into command line mode (
\begin_inset Quotes eld
\end_inset

>
\begin_inset Quotes erd
\end_inset

)
\end_layout

\end_deeper
\begin_layout Enumerate
Type 
\begin_inset Quotes eld
\end_inset

a
\begin_inset Quotes erd
\end_inset

 (assemble), and ASM-One will assemble your source.
\end_layout

\begin_layout Enumerate
Type 
\begin_inset Quotes eld
\end_inset

j
\begin_inset Quotes erd
\end_inset

 (jump), and you should see a nice picture and listening to a tune.
 (If it didn't work, you might not have AGA, 68020+ and FPU in your machine.
 Please note that WickedOS does not strictly require neither AGA nor an
 FPU, but this configuration is the baseline for the AGA/060 demos that
 we want to build with it.)
\end_layout

\begin_layout Subsubsection
With Devpac
\end_layout

\begin_layout Standard
Devpac was probably the best allround commercial assembler development package
 for the Amiga.
 If you want to give it a go, either use your existing installation or get
 a copy from the 
\begin_inset CommandInset href
LatexCommand href
name "English Amiga Board file server"
target "http://eab.abime.net/showthread.php?t=43633"
literal "false"

\end_inset

 (files 
\begin_inset Quotes eld
\end_inset

Devpac v3.04#?.adf
\begin_inset Quotes erd
\end_inset

 in /Commodore_Amiga/App/Disk/).
\end_layout

\begin_layout Standard
Once installed:
\end_layout

\begin_layout Enumerate
Project->Load the WickedOS main-file wos_v1.#?.s
\end_layout

\begin_layout Enumerate
Remove the 
\begin_inset Quotes eld
\end_inset

;
\begin_inset Quotes erd
\end_inset

 before WTEST in line 3
\end_layout

\begin_layout Enumerate
Settings->Assembler->Options
\end_layout

\begin_deeper
\begin_layout Enumerate
Processor: 68020
\end_layout

\begin_layout Enumerate
Check 
\begin_inset Quotes eld
\end_inset

68881/2 Maths Coprocessor
\begin_inset Quotes erd
\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Program->Assemble
\end_layout

\begin_layout Enumerate
Program->Run
\end_layout

\begin_layout Standard
Check the manual to learn about hotkeys, and the really powerful debugger
 
\begin_inset Quotes eld
\end_inset

monam
\begin_inset Quotes erd
\end_inset

.
 The manual is 
\begin_inset CommandInset href
LatexCommand href
name "available"
target "https://computerarchive.org/files/comp/applications/amiga/manual/Devpac%203%20-%20Manual-ENG.pdf"
literal "false"

\end_inset

 at 
\begin_inset CommandInset href
LatexCommand href
name "https://computerarchive.org/"
target "https://computerarchive.org/"
literal "false"

\end_inset

, which host lots of other Amiga manuals, too, in 
\begin_inset CommandInset href
LatexCommand href
name "/files/comp/applications/amiga/manual"
target "https://computerarchive.org/files/comp/applications/amiga/manual/"
literal "false"

\end_inset

.
\end_layout

\begin_layout Subsubsection
Recap
\end_layout

\begin_layout Standard
You tested that the supplied WickedOS-sources directly assemble and work
 on the minimum supported assembler, ASM-One (without using intermediate
 object-files and linking).
 This provides the ground for the following steps with vasm and vlink.
 
\end_layout

\begin_layout Standard
If you were planning to make extensive use of WickedOS with ASM-One or Devpac
 on Amiga, you might be interested in setting the WOSASSIGN-flag.
 This would allow you to set your working directory to somewhere else and
 then just include WickedOS from wos:newestwos.s, which would then find all
 of its files from the WOS: assign.
\end_layout

\begin_layout Standard
But even if you don't plan to use ASM-One, you must at least provide the
 assign to INCLUDES: if you plan to assemble WickedOS on Amiga.
\end_layout

\begin_layout Subsection
List of Screenmodes
\begin_inset CommandInset label
LatexCommand label
name "subsec:List-of-Screenmodes"

\end_inset


\end_layout

\begin_layout Standard
todo
\end_layout

\begin_layout Subsection
How to add a new screenmode 
\end_layout

\begin_layout Standard
Adding a new C2P-based screenmode to WickedOS requires a few modifications
 at several places in several files.
 As I tend to forget at least one place for myself, this write-up is at
 least for my own reference.
\end_layout

\begin_layout Standard
Hint: you can set wtest flag in the main wos_v#?.s source for setup and display
 a simple screen.
 Note: XY is to be replaced with a running number, e.g.
 19
\end_layout

\begin_layout Subsection*
in file wos#?.s 
\end_layout

\begin_layout Enumerate
in _wosbase:
\end_layout

\begin_deeper
\begin_layout Enumerate
mXY: dc.l 0,0,0,0 ; add some comments as well
\end_layout

\end_deeper
\begin_layout Enumerate
in WOSInit:
\end_layout

\begin_deeper
\begin_layout Enumerate
add an init block for your c2p-mode after the last one (.m18ok at the time
 of writing) 
\end_layout

\begin_layout LyX-Code
ifnd NOMODEXY 
\end_layout

\begin_deeper
\begin_layout LyX-Code
lea mXYc2p,a0 
\end_layout

\begin_layout LyX-Code
lea mXY,a1 ;dc.l 0,0,0
\end_layout

\begin_layout LyX-Code
move.l a0,(a1)+ ;Init 
\end_layout

\begin_layout LyX-Code
add.l #4,a0
\end_layout

\begin_layout LyX-Code
move.l a0,(a1)+ ;Main
\end_layout

\begin_layout LyX-Code
add.l #4,a0
\end_layout

\begin_layout LyX-Code
move.l a0,(a1)+ ;Exit
\end_layout

\end_deeper
\begin_layout LyX-Code
endc .m7ok:; feel free to add custom init code here
\end_layout

\begin_layout LyX-Code
; e.g.
 generation of ham masks or the like
\end_layout

\end_deeper
\begin_layout Enumerate
in _Display: 
\end_layout

\begin_deeper
\begin_layout Enumerate
add macro-line "_DisplayM1 XY" in first block
\end_layout

\begin_layout Enumerate
add macro-line "_DisplayM2 XY" in second block
\end_layout

\end_deeper
\begin_layout Enumerate
in _RefreshDisplay:
\end_layout

\begin_deeper
\begin_layout Enumerate
"add cmp.b #XY,d0" and "beq .mXY"
\end_layout

\begin_layout Enumerate
provide fitting code at .mXY (copy from appropriate 8 bit or ham-based examples
 above)
\end_layout

\end_deeper
\begin_layout Enumerate
in SetModeAndColors:
\end_layout

\begin_deeper
\begin_layout Enumerate
add macro-line "_SetMaCM1 XY" in first block
\end_layout

\begin_layout Enumerate
add macro-line "_SetMaCM2 XY" in second block
\end_layout

\begin_layout Enumerate
(for ham-modes) add special cmp/beq cases at ".m0" 
\end_layout

\end_deeper
\begin_layout Enumerate
in _SetMode:
\end_layout

\begin_deeper
\begin_layout Enumerate
add macro-line "_CallSetModeMac XY" in first block
\end_layout

\begin_layout Enumerate
add macro-line "_SetModeMac XY" in second block
\end_layout

\end_deeper
\begin_layout Enumerate
in _SetColors:
\end_layout

\begin_deeper
\begin_layout Enumerate
add macro-line "_SetColM1 XY" in first block
\end_layout

\begin_layout Enumerate
add macro-line "_SetColM2 XY" in second block
\end_layout

\end_deeper
\begin_layout Enumerate
in Modes:
\end_layout

\begin_deeper
\begin_layout Enumerate
provide fitting block which adds exactly one bit to MODES (double the number
 of the previous) e.g.
\end_layout

\begin_deeper
\begin_layout LyX-Code
ifnd NOMODE18 
\end_layout

\begin_deeper
\begin_layout LyX-Code
MODES set MODES!131072
\end_layout

\end_deeper
\begin_layout LyX-Code
endc
\end_layout

\begin_layout Enumerate
(this bitwise-logic is why there are currently a maximum of 32 modes supported)
\end_layout

\end_deeper
\begin_layout Enumerate
include you binary code and provide label mXYc2p 
\end_layout

\begin_deeper
\begin_layout Enumerate
(code is expected to have jump table like all the other modes - init at
 0, c2p at 4, etc..)
\end_layout

\end_deeper
\end_deeper
\begin_layout Subsection*
in file sub/wos_defines.i 
\end_layout

\begin_layout Enumerate
in struct after "Define the structure" comment
\end_layout

\begin_deeper
\begin_layout Enumerate
add four rs.l 1 entries to structure for modeXYinit, modeXYc2p, modeXYexit,
 modeXYptr
\end_layout

\end_deeper
\begin_layout Enumerate
after "Set up the screen-dimensions" comment
\end_layout

\begin_deeper
\begin_layout Enumerate
provide fitting MakeMode line to describe your screen dimensions
\end_layout

\begin_layout Enumerate
(or alternative definitions of modeXYsize ..
 modeXYsize)
\end_layout

\end_deeper
\begin_layout Subsection*
in file sub/wos_copperlists_v#?.s 
\end_layout

\begin_layout Enumerate
at EOF
\end_layout

\begin_deeper
\begin_layout Enumerate
provide fitting copperlist named CopmXY, also with labels sprmXY and colmXY
 with appropriate space
\end_layout

\end_deeper
\begin_layout Subsection*
in dir sub/chunky/sources 
\end_layout

\begin_layout Enumerate
Finally you need to provide a fitting c2p-routine as a PC-relative plugin.
 Check the provide sources and do likewise.
\end_layout

\begin_deeper
\begin_layout Enumerate
name the file as "mode#?.s"
\end_layout

\end_deeper
\begin_layout Subsection*
in file sub/chunky/sources/makefile
\end_layout

\begin_layout Enumerate
add filename to 
\noun on
Sources
\end_layout

\begin_layout Paragraph
Schematic Overview
\end_layout

\begin_layout Paragraph
\begin_inset Graphics
	filename amiga-toolchain-graph.png
	width 100text%
	clip

\end_inset


\end_layout

\begin_layout Paragraph
Todo:
\end_layout

\begin_layout Itemize
Advanced Framework Functions
\end_layout

\begin_deeper
\begin_layout Itemize
profiler
\end_layout

\begin_layout Itemize
file-watcher
\end_layout

\begin_layout Itemize
cache simulator
\end_layout

\begin_layout Itemize
palette tool
\end_layout

\end_deeper
\begin_layout Itemize
run
\end_layout

\begin_deeper
\begin_layout Itemize
visual studio command prompt
\end_layout

\begin_layout Itemize
\begin_inset Quotes eld
\end_inset

nmake install
\begin_inset Quotes erd
\end_inset

 to get the required libraries to the folder
\end_layout

\end_deeper
\begin_layout Itemize
mixasm
\end_layout

\begin_deeper
\begin_layout Itemize
ace make all
\end_layout

\end_deeper
\begin_layout Itemize
Audio, getting your music in
\end_layout

\begin_deeper
\begin_layout Itemize
music dependencies
\end_layout

\begin_deeper
\begin_layout Itemize
rocket_bpm
\end_layout

\begin_layout Itemize
rocket_rpb
\end_layout

\begin_layout Itemize
rocket_row_rate
\end_layout

\end_deeper
\begin_layout Itemize
stream player
\end_layout

\begin_deeper
\begin_layout Itemize
bass on PC
\end_layout

\begin_layout Itemize
Kalms ADPCM on Amiga
\end_layout

\end_deeper
\begin_layout Itemize
Audio ADPCM Saving and determining BPM
\end_layout

\end_deeper
\begin_layout Itemize
Screenmodes
\end_layout

\begin_deeper
\begin_layout Itemize
list of
\end_layout

\begin_layout Itemize
example
\end_layout

\end_deeper
\begin_layout Itemize
Literature
\end_layout

\begin_deeper
\begin_layout Itemize
https://www.doc.ic.ac.uk/lab/cplus/cstyle.html
\end_layout

\end_deeper
\end_body
\end_document
